"0","chi2_ind_extr <- function(x, y, design){"
"0","  my_var <- y"
"0",""
"0","# running Pearson's chi-squared test"
"0","  s_chi <- svychisq(as.formula(paste0(""~"", x,""+"", y)), design, statistic = ""Chisq"")"
"0","  "
"0","  # extracting basic parameters"
"0","  wmy_t <- as.data.frame(s_chi$observed)"
"0","  wmy_t$p <- s_chi$p.value"
"0","  wmy_t$chi_adj <- s_chi$statistic"
"0","  wmy_t$df <- s_chi$parameter"
"0","  #indicating significance"
"0","  wmy_t$independence <- ifelse(wmy_t$p < 0.05, ""h1"", ""h0"")"
"0","  colnames(wmy_t)[1:2] <- c(""var_x"", ""var_y"")"
"0","  wmy_t_w <- spread(wmy_t, var_y, Freq)"
"0","  wmy_t_w[,1] <- paste0(x, "" "", wmy_t_w[,1])"
"0","  colnames(wmy_t_w)[1] <- ""variable"""
"0","  # getting percent from weighted frequencies"
"0","  cols_no_prop <- c(""variable"", ""p"", ""independence"", ""max"", ""min"", ""chi_adj"", ""df"")"
"0","  wmy_t_w[, !colnames(wmy_t_w) %in% cols_no_prop] <- lapply(wmy_t_w[, !colnames(wmy_t_w) %in% cols_no_prop], function(x){x/sum(x, na.rm = T)})"
"0","  # indicating extremum values"
"0","  cols_to_compare <- colnames(wmy_t_w)[!colnames(wmy_t_w) %in% c(""p"", ""chi_adj"", ""df"", ""independence"", ""min"", ""max"", ""variable"")]"
"0","  wmy_t_w$max <- ifelse(wmy_t_w$independence == ""h1"", cols_to_compare[apply(wmy_t_w, 1, which.max)], 0)"
"0","  "
"0","  wmy_t_w$min <- ifelse(wmy_t_w$independence == ""h1"", cols_to_compare[apply(wmy_t_w, 1, which.min)], 0)"
"0","  "
"0","  #adding Overall value to the table"
"0","  ovl_tab <- as.data.frame(prop.table(svytable(as.formula(paste0(""~"",x)), design)))"
"0","  colnames(ovl_tab) <- c(""options"", ""overall"")"
"0","  wmy_t_w <- wmy_t_w %>% bind_cols(ovl_tab)"
"0","  return(wmy_t_w)"
"0","}"
