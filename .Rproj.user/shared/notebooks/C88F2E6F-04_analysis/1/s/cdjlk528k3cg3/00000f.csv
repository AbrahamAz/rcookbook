"0",""
"0","chi2_GoF <- function(name, stratum_hyp, stratum_2, value_stratum_hyp, value_stratum_2, data, weights){"
"0","  i <- 1"
"0","  table_1 <- data.frame()"
"0","  for (i in 1:length(name)) {"
"0","    ni <- name[i]"
"0","    ti <- data %>% "
"0","      group_by(!!sym(ni)) %>% filter(!!sym(stratum_hyp) == paste0(value_stratum_hyp)) %>%"
"0","      filter(!is.na(!!sym(ni))) %>%"
"0","      summarise(wtn = sum(!!sym(weights)), n = n()) %>%"
"0","      mutate(prop = wtn/sum(wtn), base = sum(wtn), cnt = sum(n))%>%"
"0","      mutate(varnam = ni)"
"0","    names(ti) <- c(""var"", ""wtn"", ""n"", ""prop"", ""base_w"", ""count"", ""nam"")"
"0","    table_1 <- rbind(table_1, ti)"
"0","  }"
"0","  table_cl_1 <- table_1 %>% filter(!is.na(var)) %>%"
"0","    mutate(var_id = paste0(nam, ""."", var))"
"0","  i <- 1"
"0","  table_2 <- data.frame()"
"0","  for (i in 1:length(name)) {"
"0","    ni <- name[i]"
"0","    ti <- data %>% "
"0","      group_by(!!sym(ni)) %>% filter(!!sym(stratum_2) == paste0(value_stratum_2)) %>%"
"0","      filter(!is.na(!!sym(ni))) %>%"
"0","      summarise(wtn = sum(!!sym(weights)), n = n()) %>%"
"0","      mutate(prop = wtn/sum(wtn), base = sum(wtn), cnt = sum(n))%>%"
"0","      mutate(varnam = ni)"
"0","    names(ti) <- c(""var"", ""wtn"", ""n"", ""prop"", ""base_w"", ""count"", ""nam"")"
"0","    table_2 <- rbind(table_2, ti)"
"0","  }"
"0","  "
"0","  table_cl_2 <- table_2 %>% filter(!is.na(var)) %>%"
"0","    mutate(var_id = paste0(nam, ""."", var))"
"0","  table_cl_compare <- merge(table_cl_1, table_cl_2, by = ""var_id"", all = T)"
"0","  names(table_cl_compare) <- c(""var.id"", ""var.hyp"", ""wtn.hyp"", ""n.hyp"", ""prop.hyp"", ""base.hyp"", ""base_nw.hyp"",""nam.hyp"", ""var.2"", ""wtn.2"", ""n.2"", ""prop.2"", ""base.2"", ""base_nw.2"", ""nam.2"")"
"0","  "
"0","  #Dealing with NA issues"
"0","  table_cl_compare$nam.hyp[is.na(table_cl_compare$nam.hyp)] <- table_cl_compare$nam.2[is.na(table_cl_compare$nam.hyp)]"
"0","  "
"0","  table_cl_compare$nam.2[is.na(table_cl_compare$nam.2)] <- table_cl_compare$nam.hyp[is.na(table_cl_compare$nam.2)]"
"0","  "
"0","  table_cl_compare$to_split <- table_cl_compare$nam.hyp"
"0","  "
"0","  table_cl_compare <- separate(table_cl_compare, col = to_split, into = c(""indctr"", ""item""), sep =""\\."")"
"0","  "
"0","  table_cl_compare <- table_cl_compare %>% group_by(indctr) %>% fill(base_nw.hyp, .direction  = ""down"") %>% fill(base_nw.hyp, .direction  = ""up"") %>% ungroup()"
"0","  table_cl_compare <- table_cl_compare %>% group_by(indctr) %>% fill(base.hyp, .direction  = ""down"") %>% fill(base.hyp, .direction  = ""up"") %>% ungroup()"
"0","  table_cl_compare <- table_cl_compare %>% group_by(indctr) %>% fill(base_nw.2, .direction  = ""down"") %>% fill(base_nw.2, .direction  = ""up"") %>% ungroup()"
"0","  table_cl_compare <- table_cl_compare %>% group_by(indctr) %>% fill(base.2) %>% fill(base_nw.hyp, .direction  = ""down"") %>% fill(base.2, .direction  = ""up"") %>% ungroup()"
"0","  "
"0","  table_cl_compare$prop.hyp[is.na(table_cl_compare$prop.hyp)] <- 0"
"0","  table_cl_compare$prop.2[is.na(table_cl_compare$prop.2)] <- 0"
"0","  "
"0","  table_cl_compare$wtn.hyp[is.na(table_cl_compare$wtn.hyp)] <- 0"
"0","  table_cl_compare$wtn.2[is.na(table_cl_compare$wtn.2)] <- 0"
"0","  "
"0","  table_cl_compare$chi2 <- chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp)$statistic"
"0","  table_cl_compare$p <- chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp)$p.value"
"0","  table_cl_compare$df <- chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp)$df"
"0","  "
"0","  table_cl_compare$H0 <- ifelse(table_cl_compare$p <= 0.05, ""H1 - different"", ""H0 - same"")"
"0","  return(table_cl_compare)"
"0","}"
"0",""
