<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Analysis | R cookbook for analysis with REACH</title>
  <meta name="description" content="7 Analysis | R cookbook for analysis with REACH" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Analysis | R cookbook for analysis with REACH" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Analysis | R cookbook for analysis with REACH" />
  
  
  

<meta name="author" content="R CoP" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="composite-indicators.html"/>
<link rel="next" href="outputs.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hello</a></li>
<li class="chapter" data-level="2" data-path="meta-information.html"><a href="meta-information.html"><i class="fa fa-check"></i><b>2</b> Meta information</a>
<ul>
<li class="chapter" data-level="2.1" data-path="meta-information.html"><a href="meta-information.html#creating-the-questionnaire-object"><i class="fa fa-check"></i><b>2.1</b> Creating the questionnaire object</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html"><i class="fa fa-check"></i><b>3</b> Downloading data from kobo server</a>
<ul>
<li class="chapter" data-level="3.1" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#defining-the-needed-functions"><i class="fa fa-check"></i><b>3.1</b> Defining the needed functions</a></li>
<li class="chapter" data-level="3.2" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#creating-data-url-and-credentials-variables"><i class="fa fa-check"></i><b>3.2</b> Creating data url and credentials variables</a></li>
<li class="chapter" data-level="3.3" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#fetching-the-data-from-the-server"><i class="fa fa-check"></i><b>3.3</b> Fetching the data from the server</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pre-analysis.html"><a href="pre-analysis.html"><i class="fa fa-check"></i><b>4</b> Pre analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="pre-analysis.html"><a href="pre-analysis.html#checking-the-xls-kobo-tools-for-constraints-errors"><i class="fa fa-check"></i><b>4.1</b> Checking the XLS kobo tools for constraints errors</a></li>
<li class="chapter" data-level="4.2" data-path="pre-analysis.html"><a href="pre-analysis.html#sampling"><i class="fa fa-check"></i><b>4.2</b> Sampling</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="pre-analysis.html"><a href="pre-analysis.html#simple-random-sampling"><i class="fa fa-check"></i><b>4.2.1</b> Simple Random sampling</a></li>
<li class="chapter" data-level="4.2.2" data-path="pre-analysis.html"><a href="pre-analysis.html#stratified-random-sampling"><i class="fa fa-check"></i><b>4.2.2</b> Stratified Random sampling</a></li>
<li class="chapter" data-level="4.2.3" data-path="pre-analysis.html"><a href="pre-analysis.html#cluster-sampling"><i class="fa fa-check"></i><b>4.2.3</b> Cluster sampling</a></li>
<li class="chapter" data-level="4.2.4" data-path="pre-analysis.html"><a href="pre-analysis.html#stages-random-sampling"><i class="fa fa-check"></i><b>4.2.4</b> 2 stages random sampling</a></li>
<li class="chapter" data-level="4.2.5" data-path="pre-analysis.html"><a href="pre-analysis.html#sample-distribution-usin-population-raster"><i class="fa fa-check"></i><b>4.2.5</b> Sample distribution usin population raster</a></li>
<li class="chapter" data-level="4.2.6" data-path="pre-analysis.html"><a href="pre-analysis.html#generation-of-random-sample-points"><i class="fa fa-check"></i><b>4.2.6</b> Generation of random sample points</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html"><i class="fa fa-check"></i><b>5</b> Data Collection and Processing</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#testing-the-tool"><i class="fa fa-check"></i><b>5.1</b> Testing the tool</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#creating-dummy-data"><i class="fa fa-check"></i><b>5.1.1</b> Creating dummy data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#download-data"><i class="fa fa-check"></i><b>5.2</b> Download data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#downloading-audit-files-using-audit_url"><i class="fa fa-check"></i><b>5.2.1</b> Downloading Audit files using audit_URL</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#download-audit-files-using-form-name"><i class="fa fa-check"></i><b>5.2.2</b> Download audit files using form name</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-collection-follow-up"><i class="fa fa-check"></i><b>5.3</b> Data collection follow-up</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#checking-surveys-against-the-sampling-frame"><i class="fa fa-check"></i><b>5.3.1</b> checking surveys against the sampling frame</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-falsification"><i class="fa fa-check"></i><b>5.4</b> Data falsification</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time-in-the-dataset"><i class="fa fa-check"></i><b>5.4.1</b> Check for time (in the dataset)</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time-audit-files"><i class="fa fa-check"></i><b>5.4.2</b> Check for time (audit files)</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time---calculating-the-elapsed-time-between-each-interview"><i class="fa fa-check"></i><b>5.4.3</b> Check for time - calculating the elapsed time between each interview</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#silouhette-analysis"><i class="fa fa-check"></i><b>5.4.4</b> Silouhette analysis</a></li>
<li class="chapter" data-level="5.4.5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-duplicates"><i class="fa fa-check"></i><b>5.4.5</b> Check for duplicates</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-checks"><i class="fa fa-check"></i><b>5.5</b> Data checks</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-outliers"><i class="fa fa-check"></i><b>5.5.1</b> Check for outliers</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-others"><i class="fa fa-check"></i><b>5.5.2</b> Check others</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-logical-check"><i class="fa fa-check"></i><b>5.5.3</b> Check for logical check</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#cleaninginspector---inspect_all"><i class="fa fa-check"></i><b>5.6</b> cleaninginspectoR - inspect_all</a></li>
<li class="chapter" data-level="5.7" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-cleaning"><i class="fa fa-check"></i><b>5.7</b> Data cleaning</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#re-generate-text-column-for-select-multiple-questions"><i class="fa fa-check"></i><b>5.7.1</b> Re-generate text column for select multiple questions</a></li>
<li class="chapter" data-level="5.7.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#clean-data-base-on-cleaning-log"><i class="fa fa-check"></i><b>5.7.2</b> Clean data base on cleaning log</a></li>
<li class="chapter" data-level="5.7.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-cleaning-log-raw-dataset-and-clean-dataset"><i class="fa fa-check"></i><b>5.7.3</b> Check cleaning log, raw dataset and clean dataset</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-cleaning---miscellaneous"><i class="fa fa-check"></i><b>5.8</b> Data cleaning - miscellaneous</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-data-sanity-check-if-the-data-follow-odk-format-select_one-select_multiple-xxx-choices"><i class="fa fa-check"></i><b>5.8.1</b> Check for data sanity check if the data follow ODK format (select_one, select_multiple, xxx, choices)</a></li>
<li class="chapter" data-level="5.8.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#turns-label-to-xml"><i class="fa fa-check"></i><b>5.8.2</b> Turns label to xml</a></li>
<li class="chapter" data-level="5.8.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#statistical-disclosure-control-methods"><i class="fa fa-check"></i><b>5.8.3</b> Statistical Disclosure Control Methods</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#spatial-verification-checks"><i class="fa fa-check"></i><b>5.9</b> Spatial verification checks</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#spatial-verification-checks-on-settlement-level"><i class="fa fa-check"></i><b>5.9.1</b> Spatial verification checks on settlement level</a></li>
<li class="chapter" data-level="5.9.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#spatial-verification-checks-on-sample-point-level"><i class="fa fa-check"></i><b>5.9.2</b> Spatial verification checks on sample point level</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="composite-indicators.html"><a href="composite-indicators.html"><i class="fa fa-check"></i><b>6</b> Composite indicators</a>
<ul>
<li class="chapter" data-level="6.1" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-one"><i class="fa fa-check"></i><b>6.1</b> Composite with 1 categorical variable - select one</a></li>
<li class="chapter" data-level="6.2" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-categorical-variables"><i class="fa fa-check"></i><b>6.2</b> Composite with 2 categorical variables</a></li>
<li class="chapter" data-level="6.3" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-multiple"><i class="fa fa-check"></i><b>6.3</b> Composite with 1 categorical variable - select multiple</a></li>
<li class="chapter" data-level="6.4" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-numerical-variable"><i class="fa fa-check"></i><b>6.4</b> Composite with 1 numerical variable</a></li>
<li class="chapter" data-level="6.5" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-numerical-variables"><i class="fa fa-check"></i><b>6.5</b> Composite with 2 numerical variables</a></li>
<li class="chapter" data-level="6.6" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-or-more-numerical-variables"><i class="fa fa-check"></i><b>6.6</b> Composite with 2 or more numerical variables</a></li>
<li class="chapter" data-level="6.7" data-path="composite-indicators.html"><a href="composite-indicators.html#new-indicators-from-a-loop-to-main-dataset"><i class="fa fa-check"></i><b>6.7</b> New indicators from a loop to main dataset</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>7</b> Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="analysis.html"><a href="analysis.html#hypegrammar"><i class="fa fa-check"></i><b>7.1</b> hypegrammaR</a></li>
<li class="chapter" data-level="7.2" data-path="analysis.html"><a href="analysis.html#srvyr-package"><i class="fa fa-check"></i><b>7.2</b> srvyr package</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="analysis.html"><a href="analysis.html#categorical-variables"><i class="fa fa-check"></i><b>7.2.1</b> Categorical variables</a></li>
<li class="chapter" data-level="7.2.2" data-path="analysis.html"><a href="analysis.html#numeric-variables"><i class="fa fa-check"></i><b>7.2.2</b> Numeric variables</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="analysis.html"><a href="analysis.html#butter-survey_collapse"><i class="fa fa-check"></i><b>7.3</b> butteR survey_collapse</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="analysis.html"><a href="analysis.html#select_one"><i class="fa fa-check"></i><b>7.3.1</b> select_one</a></li>
<li class="chapter" data-level="7.3.2" data-path="analysis.html"><a href="analysis.html#select_mutiple"><i class="fa fa-check"></i><b>7.3.2</b> select_mutiple</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="analysis.html"><a href="analysis.html#analysis-with-numerical-variables"><i class="fa fa-check"></i><b>7.4</b> Analysis with numerical variables</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="analysis.html"><a href="analysis.html#averages"><i class="fa fa-check"></i><b>7.4.1</b> Averages</a></li>
<li class="chapter" data-level="7.4.2" data-path="analysis.html"><a href="analysis.html#median"><i class="fa fa-check"></i><b>7.4.2</b> Median</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="analysis.html"><a href="analysis.html#ratios"><i class="fa fa-check"></i><b>7.5</b> Ratios</a>
<ul>
<li><a href="analysis.html#example1"><span class="toc-section-number">7.5.1</span> Example1:<br />
</a></li>
<li><a href="analysis.html#example2---analyzing-multiple-questions-and-combine-the-output"><span class="toc-section-number">7.5.2</span> Example2 - Analyzing multiple questions and combine the output:<br />
</a></li>
<li><a href="analysis.html#example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted"><span class="toc-section-number">7.5.3</span> Example3 - No dissagregation is needed and/or the data is not weighted:<br />
</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="analysis.html"><a href="analysis.html#weights"><i class="fa fa-check"></i><b>7.6</b> Weights</a></li>
<li class="chapter" data-level="7.7" data-path="analysis.html"><a href="analysis.html#repeating-the-above"><i class="fa fa-check"></i><b>7.7</b> Repeating the above</a></li>
<li class="chapter" data-level="7.8" data-path="analysis.html"><a href="analysis.html#analysis---top-x-ranking-select-one-and-select-multiple"><i class="fa fa-check"></i><b>7.8</b> Analysis - top X / ranking (select one and select multiple)</a></li>
<li class="chapter" data-level="7.9" data-path="analysis.html"><a href="analysis.html#borda-count"><i class="fa fa-check"></i><b>7.9</b> Borda count</a></li>
<li class="chapter" data-level="7.10" data-path="analysis.html"><a href="analysis.html#hypothesis-testing"><i class="fa fa-check"></i><b>7.10</b> Hypothesis testing</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="analysis.html"><a href="analysis.html#t-test"><i class="fa fa-check"></i><b>7.10.1</b> T-test</a></li>
<li class="chapter" data-level="7.10.2" data-path="analysis.html"><a href="analysis.html#anova"><i class="fa fa-check"></i><b>7.10.2</b> ANOVA</a></li>
<li class="chapter" data-level="7.10.3" data-path="analysis.html"><a href="analysis.html#chi-squares"><i class="fa fa-check"></i><b>7.10.3</b> chi-squares</a></li>
<li class="chapter" data-level="7.10.4" data-path="analysis.html"><a href="analysis.html#chi-squared-goodness-of-fit-test"><i class="fa fa-check"></i><b>7.10.4</b> Chi-squared Goodness of Fit test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>8</b> Outputs</a>
<ul>
<li class="chapter" data-level="8.1" data-path="outputs.html"><a href="outputs.html#from-long-to-large-table"><i class="fa fa-check"></i><b>8.1</b> From long to large table</a></li>
<li class="chapter" data-level="8.2" data-path="outputs.html"><a href="outputs.html#merge-file"><i class="fa fa-check"></i><b>8.2</b> Merge file</a></li>
<li class="chapter" data-level="8.3" data-path="outputs.html"><a href="outputs.html#graphs"><i class="fa fa-check"></i><b>8.3</b> Graphs</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="outputs.html"><a href="outputs.html#spider-graphs"><i class="fa fa-check"></i><b>8.3.1</b> spider graphs</a></li>
<li class="chapter" data-level="8.3.2" data-path="outputs.html"><a href="outputs.html#prison-graphs"><i class="fa fa-check"></i><b>8.3.2</b> prison graphs</a></li>
<li class="chapter" data-level="8.3.3" data-path="outputs.html"><a href="outputs.html#bar-graphs"><i class="fa fa-check"></i><b>8.3.3</b> Bar graphs</a></li>
<li class="chapter" data-level="8.3.4" data-path="outputs.html"><a href="outputs.html#euler-diagram"><i class="fa fa-check"></i><b>8.3.4</b> Euler diagram</a></li>
<li class="chapter" data-level="8.3.5" data-path="outputs.html"><a href="outputs.html#venn-diagram"><i class="fa fa-check"></i><b>8.3.5</b> Venn diagram</a></li>
<li class="chapter" data-level="8.3.6" data-path="outputs.html"><a href="outputs.html#upset-plots"><i class="fa fa-check"></i><b>8.3.6</b> UpSet plots</a></li>
<li class="chapter" data-level="8.3.7" data-path="outputs.html"><a href="outputs.html#boxplots"><i class="fa fa-check"></i><b>8.3.7</b> boxplots</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="outputs.html"><a href="outputs.html#labels"><i class="fa fa-check"></i><b>8.4</b> Labels</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="outputs.html"><a href="outputs.html#change-from-xml-to-label"><i class="fa fa-check"></i><b>8.4.1</b> change from xml to label</a></li>
<li class="chapter" data-level="8.4.2" data-path="outputs.html"><a href="outputs.html#change-from-label-to-xml"><i class="fa fa-check"></i><b>8.4.2</b> change from label to xml</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="outputs.html"><a href="outputs.html#dashboarding---sharing-information"><i class="fa fa-check"></i><b>8.5</b> Dashboarding - Sharing information</a></li>
<li class="chapter" data-level="8.6" data-path="outputs.html"><a href="outputs.html#outputs-with-hypothesis-testing-results"><i class="fa fa-check"></i><b>8.6</b> Outputs with hypothesis testing results</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>9</b> Miscellaneous</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R cookbook for analysis with REACH</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Analysis</h1>
<div id="hypegrammar" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> hypegrammaR</h2>
<p>hypegrammaR follow the case mapping logic to compute analysis. It will also use the kobo questionnaire tool to help some of decision to be made.</p>
<p>This just load the information that will be need to conduct the analysis :</p>
<ul>
<li>dataset,</li>
<li>kobotool (questions and choices),</li>
<li>sample frame</li>
</ul>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="analysis.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hypegrammaR)</span>
<span id="cb127-2"><a href="analysis.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb127-3"><a href="analysis.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(surveyweights)</span>
<span id="cb127-4"><a href="analysis.html#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb127-5"><a href="analysis.html#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb127-6"><a href="analysis.html#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb127-7"><a href="analysis.html#cb127-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-8"><a href="analysis.html#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="co">#load dataset</span></span>
<span id="cb127-9"><a href="analysis.html#cb127-9" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>,<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb127-10"><a href="analysis.html#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="analysis.html#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="co">#load kobotool</span></span>
<span id="cb127-12"><a href="analysis.html#cb127-12" aria-hidden="true" tabindex="-1"></a>questions <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;survey&quot;</span>)</span>
<span id="cb127-13"><a href="analysis.html#cb127-13" aria-hidden="true" tabindex="-1"></a>choices <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;choices&quot;</span>)</span>
<span id="cb127-14"><a href="analysis.html#cb127-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-15"><a href="analysis.html#cb127-15" aria-hidden="true" tabindex="-1"></a><span class="co">#load sampling frame</span></span>
<span id="cb127-16"><a href="analysis.html#cb127-16" aria-hidden="true" tabindex="-1"></a>my_sampling_frame <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_GCA_Weights_26AUG2020.xlsx&quot;</span>, </span>
<span id="cb127-17"><a href="analysis.html#cb127-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sheet =</span> <span class="st">&quot;for_r&quot;</span>)</span></code></pre></div>
<p>The questionnaire object is a list of function using the kobotool and dataset as input. For example, it will check if a given variable is a select multiple or not.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="analysis.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a questionnaire object</span></span>
<span id="cb128-2"><a href="analysis.html#cb128-2" aria-hidden="true" tabindex="-1"></a>my_questionnaire <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">load_questionnaire</span>(<span class="at">data =</span> main_dataset,</span>
<span id="cb128-3"><a href="analysis.html#cb128-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">questions =</span> questions,</span>
<span id="cb128-4"><a href="analysis.html#cb128-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> choices,</span>
<span id="cb128-5"><a href="analysis.html#cb128-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices.label.column.to.use =</span> <span class="st">&quot;label::English&quot;</span>)</span></code></pre></div>
<p>The weighting function is created by the weighting_fun_from_samplinframe from the surveyweights package. It calculates the design weight based on the sampling frame and the dataset. The stratification names values used in the sampling frame and the dataset <strong>HAS</strong> to be the same.
What it does, it create a function that will calculate the weights based on your dataset.
<em>(It was defined as a function so it could re-calculate weights depending on the subset. however, the current guidelines is to keep the same design weights through all the assessement; the function still works for that case)</em></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="analysis.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a weigthing function</span></span>
<span id="cb129-2"><a href="analysis.html#cb129-2" aria-hidden="true" tabindex="-1"></a>my_weigthing_function <span class="ot">&lt;-</span> surveyweights<span class="sc">::</span><span class="fu">weighting_fun_from_samplingframe</span>(<span class="at">sampling.frame =</span> my_sampling_frame,</span>
<span id="cb129-3"><a href="analysis.html#cb129-3" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">data.stratum.column =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb129-4"><a href="analysis.html#cb129-4" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">sampling.frame.population.column =</span> <span class="st">&quot;population&quot;</span>, </span>
<span id="cb129-5"><a href="analysis.html#cb129-5" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">sampling.frame.stratum.column =</span> <span class="st">&quot;strata&quot;</span>, </span>
<span id="cb129-6"><a href="analysis.html#cb129-6" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">data =</span> main_dataset)</span></code></pre></div>
<p>If you want to add the weights to your dataframe this is how you can do it.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="analysis.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#optional, if you want to add the weights into the dataset.</span></span>
<span id="cb130-2"><a href="analysis.html#cb130-2" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>stratum.weight <span class="ot">&lt;-</span> <span class="fu">my_weigthing_function</span>(main_dataset)</span></code></pre></div>
<p>hypegrammaR uses cases to choose what type analysis to do. A “case” for hypegrammaR is a character string CASE_XXXX_YYYY_ZZZZ where :</p>
<ul>
<li>XXXX: hypothesis type (group_difference, direct_reporting)<br />
</li>
<li>YYYY: dependent var type (categorical, numerical)<br />
</li>
<li>ZZZZ: independent var type (categorical, numerical, <em>empty</em> if no independent variable) .</li>
</ul>
<p>All cases implemented can been seen with this code.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="analysis.html#cb131-1" aria-hidden="true" tabindex="-1"></a>hypegrammaR<span class="sc">:::</span><span class="fu">list_all_cases</span>(<span class="at">implemented_only =</span> T)</span></code></pre></div>
<pre><code>##  [1] &quot;CASE_group_difference_categorical_categorical&quot;
##  [2] &quot;CASE_group_difference_numerical_categorical&quot;  
##  [3] &quot;CASE_direct_reporting_numerical_&quot;             
##  [4] &quot;CASE_direct_reporting_categorical_&quot;           
##  [5] &quot;CASE_direct_reporting_categorical_categorical&quot;
##  [6] &quot;CASE_direct_reporting_numerical_categorical&quot;  
##  [7] &quot;CASE_limit_categorical&quot;                       
##  [8] &quot;CASE_limit_numerical&quot;                         
##  [9] &quot;CASE_correlation_numerical_numerical&quot;         
## [10] &quot;CASE_correlation_categorical_numerical&quot;</code></pre>
<p>If you want to know what are the different proportion of the displacement status for each strata. The following information I need are:
hypothesis : group_difference<br />
dependent variable : d1_hh_displacement_status -&gt; categorical<br />
independent_variable : strata -&gt; categorical</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="analysis.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">#analysis </span></span>
<span id="cb133-2"><a href="analysis.html#cb133-2" aria-hidden="true" tabindex="-1"></a>my_case <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">map_to_case</span>(<span class="at">hypothesis.type =</span> <span class="st">&quot;group_difference&quot;</span>,</span>
<span id="cb133-3"><a href="analysis.html#cb133-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dependent.var.type =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb133-4"><a href="analysis.html#cb133-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">independent.var.type =</span> <span class="st">&quot;categorical&quot;</span>)</span>
<span id="cb133-5"><a href="analysis.html#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="analysis.html#cb133-6" aria-hidden="true" tabindex="-1"></a>my_case</span></code></pre></div>
<pre><code>## [1] &quot;CASE_group_difference_categorical_categorical&quot;
## attr(,&quot;class&quot;)
## [1] &quot;analysis_case&quot;</code></pre>
<p>The function map_to_result will calculate your summary statistics, it will take a couple of arguments.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="analysis.html#cb135-1" aria-hidden="true" tabindex="-1"></a>my_results <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">map_to_result</span>(<span class="at">data =</span> main_dataset, </span>
<span id="cb135-2"><a href="analysis.html#cb135-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">dependent.var =</span> <span class="st">&quot;d1_hh_displacement_status&quot;</span>, </span>
<span id="cb135-3"><a href="analysis.html#cb135-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">independent.var =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb135-4"><a href="analysis.html#cb135-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">case =</span> my_case, </span>
<span id="cb135-5"><a href="analysis.html#cb135-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">weighting =</span> my_weigthing_function,</span>
<span id="cb135-6"><a href="analysis.html#cb135-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">questionnaire =</span> my_questionnaire,</span>
<span id="cb135-7"><a href="analysis.html#cb135-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">confidence_level =</span> .<span class="dv">90</span>)</span></code></pre></div>
<p>The result object is a list with several information:</p>
<ul>
<li>parameters: returns the information used of that analysis</li>
<li>summary statistics: returns the summary statistics in a tidy format</li>
<li>hypothesis test: returns hypothesis testing information (if avalaible)</li>
<li>message: returns a message (if the analysis went well or not)</li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="analysis.html#cb136-1" aria-hidden="true" tabindex="-1"></a>my_results<span class="sc">$</span>summary.statistic <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##               dependent.var independent.var
## 1 d1_hh_displacement_status          strata
## 2 d1_hh_displacement_status          strata
## 3 d1_hh_displacement_status          strata
## 4 d1_hh_displacement_status          strata
## 5 d1_hh_displacement_status          strata
## 6 d1_hh_displacement_status          strata
##                                          dependent.var.value
## 1                                   displaced_and_idp_status
## 2                     displaced_but_does_not_have_idp_status
## 3                                                         no
## 4               partially_displaced_and_dont_have_idp_status
## 5                    partially_displaced_and_have_idp_status
## 6 used_to_be_displaced_but_returned_and_has_no_status_of_idp
##   independent.var.value     numbers se           min         max
## 1            20km_rural 0.046683047 NA  0.0261473551 0.067218738
## 2            20km_rural 0.002457002 NA -0.0023622501 0.007276255
## 3            20km_rural 0.911547912 NA  0.8839068400 0.939188983
## 4            20km_rural 0.007371007 NA -0.0009555979 0.015697613
## 5            20km_rural 0.022113022 NA  0.0077984141 0.036427630
## 6            20km_rural 0.009828010 NA  0.0002251810 0.019430839</code></pre>
<p>If you need to run several analysis, you can use a data analysis plan (DAP) file which is a file that comprises of the following columns:</p>
<ul>
<li>dependent.variable: name of the dependent variable (kobo name, column name)<br />
</li>
<li>dependent.variable.type: type of the dependent variable (categorical or numerical or empty)<br />
</li>
<li>independent.variable: name of the independent variable (kobo name, column name)<br />
</li>
<li>independent.variable.type: type of the independent variable (categorical or numerical or empty)<br />
</li>
<li>repeat.for.variable: name of the variable to repeat the analysis for (e.g per camp or district or governorate)<br />
</li>
<li>hypothesis.type: type of hypothesis (group_difference, direct_reporting)</li>
<li>you can have other columns to help you write the analysis plan such as RQ and sub RQ</li>
</ul>
<p><strong>You cannot have duplicate columns</strong></p>
<p>Below, I am creating the DAP, but you could read a csv file. It has :</p>
<ul>
<li>2 categorical variables, (select multiple type in kobo), <em>l4_which_difficult_access_health</em> and <em>j10_education_security_concerns_in_the_vicinity_of_facility</em></li>
<li>2 categorical variables, (select one type in kobo), <em>b9_hohh_marital_status</em> and <em>d1_hh_displacement_status</em>,</li>
<li>2 numerical variables (integer type in kobo): <em>b7_hohh_age</em> and <em>b5_age</em></li>
</ul>
<p>It will repeat the analysis 3 times for each dependent variable:</p>
<ul>
<li>using the <em>strata</em> variable as independent variable (first 6 rows),</li>
<li>using no independent variable, for the complete dataset (national level?), (second 6 rows),</li>
<li>using the <em>b9_hohh_marital_status</em> as independent variable but repeating each strata (last 6 rows)</li>
</ul>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="analysis.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dap </span></span>
<span id="cb138-2"><a href="analysis.html#cb138-2" aria-hidden="true" tabindex="-1"></a>my_dap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">dependent.variable =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>, <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>, <span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb138-3"><a href="analysis.html#cb138-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;b5_age&quot;</span>, <span class="st">&quot;b9_hohh_marital_status&quot;</span>,</span>
<span id="cb138-4"><a href="analysis.html#cb138-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>), <span class="dv">2</span>), <span class="fu">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>, <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>, <span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb138-5"><a href="analysis.html#cb138-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;b5_age&quot;</span>,</span>
<span id="cb138-6"><a href="analysis.html#cb138-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>)),</span>
<span id="cb138-7"><a href="analysis.html#cb138-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dependent.variable.type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>),<span class="dv">2</span>),<span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;categorical&quot;</span>),</span>
<span id="cb138-8"><a href="analysis.html#cb138-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">independent.variable =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;strata&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;b9_hohh_marital_status&quot;</span>, <span class="dv">5</span>)),</span>
<span id="cb138-9"><a href="analysis.html#cb138-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">independent.variable.type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;categorical&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;categorical&quot;</span>, <span class="dv">5</span>)), </span>
<span id="cb138-10"><a href="analysis.html#cb138-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hypothesis.type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;group_difference&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;direct_reporting&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;group_difference&quot;</span>, <span class="dv">5</span>)), </span>
<span id="cb138-11"><a href="analysis.html#cb138-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">repeat.for.variable =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">12</span>), <span class="fu">rep</span>(<span class="st">&quot;strata&quot;</span>, <span class="dv">5</span>))</span>
<span id="cb138-12"><a href="analysis.html#cb138-12" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb138-13"><a href="analysis.html#cb138-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-14"><a href="analysis.html#cb138-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-15"><a href="analysis.html#cb138-15" aria-hidden="true" tabindex="-1"></a>my_dap </span></code></pre></div>
<pre><code>##                                             dependent.variable
## 1                             l4_which_difficult_access_health
## 2  j10_education_security_concerns_in_the_vicinity_of_facility
## 3                                                  b7_hohh_age
## 4                                                       b5_age
## 5                                       b9_hohh_marital_status
## 6                                    d1_hh_displacement_status
## 7                             l4_which_difficult_access_health
## 8  j10_education_security_concerns_in_the_vicinity_of_facility
## 9                                                  b7_hohh_age
## 10                                                      b5_age
## 11                                      b9_hohh_marital_status
## 12                                   d1_hh_displacement_status
## 13                            l4_which_difficult_access_health
## 14 j10_education_security_concerns_in_the_vicinity_of_facility
## 15                                                 b7_hohh_age
## 16                                                      b5_age
## 17                                   d1_hh_displacement_status
##    dependent.variable.type   independent.variable independent.variable.type
## 1              categorical                 strata               categorical
## 2              categorical                 strata               categorical
## 3                numerical                 strata               categorical
## 4                numerical                 strata               categorical
## 5              categorical                 strata               categorical
## 6              categorical                 strata               categorical
## 7              categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 8              categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 9                numerical                   &lt;NA&gt;                      &lt;NA&gt;
## 10               numerical                   &lt;NA&gt;                      &lt;NA&gt;
## 11             categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 12             categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 13             categorical b9_hohh_marital_status               categorical
## 14             categorical b9_hohh_marital_status               categorical
## 15               numerical b9_hohh_marital_status               categorical
## 16               numerical b9_hohh_marital_status               categorical
## 17             categorical b9_hohh_marital_status               categorical
##     hypothesis.type repeat.for.variable
## 1  group_difference                &lt;NA&gt;
## 2  group_difference                &lt;NA&gt;
## 3  group_difference                &lt;NA&gt;
## 4  group_difference                &lt;NA&gt;
## 5  group_difference                &lt;NA&gt;
## 6  group_difference                &lt;NA&gt;
## 7  direct_reporting                &lt;NA&gt;
## 8  direct_reporting                &lt;NA&gt;
## 9  direct_reporting                &lt;NA&gt;
## 10 direct_reporting                &lt;NA&gt;
## 11 direct_reporting                &lt;NA&gt;
## 12 direct_reporting                &lt;NA&gt;
## 13 group_difference              strata
## 14 group_difference              strata
## 15 group_difference              strata
## 16 group_difference              strata
## 17 group_difference              strata</code></pre>
<p>To use a DAP, you need to use the function <strong>from_analysisplan_map_to_output</strong> instead of the combination of <strong>map_to_case</strong> and <strong>map_to_result</strong>. It will look for the case itself. <strong>from_analysisplan_map_to_output</strong> a list of list of results. So you need to wriggle a bit around to come to a master dataframe.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="analysis.html#cb140-1" aria-hidden="true" tabindex="-1"></a>my_results <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">from_analysisplan_map_to_output</span>(<span class="at">data =</span>main_dataset,</span>
<span id="cb140-2"><a href="analysis.html#cb140-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">analysisplan =</span> my_dap,</span>
<span id="cb140-3"><a href="analysis.html#cb140-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">weighting =</span> my_weigthing_function,</span>
<span id="cb140-4"><a href="analysis.html#cb140-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">questionnaire =</span> my_questionnaire,</span>
<span id="cb140-5"><a href="analysis.html#cb140-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">confidence_level =</span> .<span class="dv">90</span>)</span>
<span id="cb140-6"><a href="analysis.html#cb140-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-7"><a href="analysis.html#cb140-7" aria-hidden="true" tabindex="-1"></a>long_table <span class="ot">&lt;-</span> my_results<span class="sc">$</span>results <span class="sc">%&gt;%</span> </span>
<span id="cb140-8"><a href="analysis.html#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) x[[<span class="st">&quot;summary.statistic&quot;</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb140-9"><a href="analysis.html#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, .)</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="analysis.html#cb141-1" aria-hidden="true" tabindex="-1"></a>long_table <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##                      dependent.var independent.var dependent.var.value
## 1 l4_which_difficult_access_health          strata  lack_of_facilities
## 2 l4_which_difficult_access_health          strata  lack_of_facilities
## 3 l4_which_difficult_access_health          strata  lack_of_facilities
## 4 l4_which_difficult_access_health          strata  lack_of_facilities
## 5 l4_which_difficult_access_health          strata    cost_of_medicine
## 6 l4_which_difficult_access_health          strata    cost_of_medicine
##   independent.var.value   numbers se        min       max repeat.var
## 1            20km_rural 0.2131148 NA 0.15352034 0.2727092       &lt;NA&gt;
## 2            20km_urban 0.1013514 NA 0.05248276 0.1502199       &lt;NA&gt;
## 3             5km_rural 0.2500000 NA 0.19147544 0.3085246       &lt;NA&gt;
## 4             5km_urban 0.1160221 NA 0.06915872 0.1628855       &lt;NA&gt;
## 5            20km_rural 0.8579235 NA 0.80711592 0.9087311       &lt;NA&gt;
## 6            20km_urban 0.8378378 NA 0.77815151 0.8975242       &lt;NA&gt;
##   repeat.var.value
## 1             &lt;NA&gt;
## 2             &lt;NA&gt;
## 3             &lt;NA&gt;
## 4             &lt;NA&gt;
## 5             &lt;NA&gt;
## 6             &lt;NA&gt;</code></pre>
</div>
<div id="srvyr-package" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> srvyr package</h2>
<p>“The srvyr package aims to add dplyr like syntax to the survey package.” It is a very useful package for a variety of aggregations of survey data.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="analysis.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="do">###makes some additions. </span></span>
<span id="cb143-2"><a href="analysis.html#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb143-3"><a href="analysis.html#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(butteR)</span>
<span id="cb143-4"><a href="analysis.html#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb143-5"><a href="analysis.html#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb143-6"><a href="analysis.html#cb143-6" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>)</span>
<span id="cb143-7"><a href="analysis.html#cb143-7" aria-hidden="true" tabindex="-1"></a>dfsvy<span class="ot">&lt;-</span><span class="fu">as_survey</span>(df)</span></code></pre></div>
<div id="categorical-variables" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Categorical variables</h3>
<p>srvyr package allows categorical variables to be broken down using a similar syntax as dplyr. Using dplyr you might typically calculate a percent mean as follows:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="analysis.html#cb144-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="analysis.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(b9_hohh_marital_status) <span class="sc">%&gt;%</span> </span>
<span id="cb144-3"><a href="analysis.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb144-4"><a href="analysis.html#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n=</span><span class="fu">n</span>()</span>
<span id="cb144-5"><a href="analysis.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb144-6"><a href="analysis.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb144-7"><a href="analysis.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb144-8"><a href="analysis.html#cb144-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_mean=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb144-9"><a href="analysis.html#cb144-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   b9_hohh_marital_status                        n pct_mean
##   &lt;chr&gt;                                     &lt;int&gt;    &lt;dbl&gt;
## 1 divorced                                    183   0.113 
## 2 married                                     677   0.419 
## 3 separated_married_but_not_living_together    37   0.0229
## 4 single                                      129   0.0798
## 5 unmarried_but_living_together                96   0.0594
## 6 widowed                                     495   0.306</code></pre>
<p>To calculate the percent mean of a categorical variable using srvyr object is required. The syntax is quite similar to dplyr, but a bit less verbose. By specifying the vartype as “ci” we also get the upper and lower confidence intervals</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="analysis.html#cb146-1" aria-hidden="true" tabindex="-1"></a>dfsvy <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="analysis.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(b9_hohh_marital_status) <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="analysis.html#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb146-4"><a href="analysis.html#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_mean =</span> <span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb146-5"><a href="analysis.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   b9_hohh_marital_status                    pct_mean pct_mean_low pct_mean_upp
##   &lt;chr&gt;                                        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 divorced                                    0.113        0.0977       0.129 
## 2 married                                     0.419        0.395        0.443 
## 3 separated_married_but_not_living_together   0.0229       0.0156       0.0302
## 4 single                                      0.0798       0.0666       0.0930
## 5 unmarried_but_living_together               0.0594       0.0478       0.0709
## 6 widowed                                     0.306        0.284        0.329</code></pre>
<p>To calculate the weigthed percent mean of a multiple response option you need to created a srvyr object including the weights. The syntax is similar to dyplr and allows for the total columns</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="analysis.html#cb148-1" aria-hidden="true" tabindex="-1"></a>weighted_object <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span> <span class="fu">as_survey_design</span>(<span class="at">ids =</span> X_uuid, <span class="at">weights =</span> stratum.weight)</span>
<span id="cb148-2"><a href="analysis.html#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="analysis.html#cb148-3" aria-hidden="true" tabindex="-1"></a>weighted_table <span class="ot">&lt;-</span> weighted_object <span class="sc">%&gt;%</span> </span>
<span id="cb148-4"><a href="analysis.html#cb148-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">group_by</span>(adm1NameLat) <span class="sc">%&gt;%</span> <span class="co">#group by categorical variable</span></span>
<span id="cb148-5"><a href="analysis.html#cb148-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b10_hohh_vulnerability.&quot;</span>)), survey_mean) <span class="sc">%&gt;%</span> <span class="co">#select multiple response question</span></span>
<span id="cb148-6"><a href="analysis.html#cb148-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-7"><a href="analysis.html#cb148-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bind_rows</span>(</span>
<span id="cb148-8"><a href="analysis.html#cb148-8" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">summarise_at</span>(weighted_object,</span>
<span id="cb148-9"><a href="analysis.html#cb148-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b10_hohh_vulnerability.&quot;</span>)), survey_mean) <span class="co"># bind the total</span></span>
<span id="cb148-10"><a href="analysis.html#cb148-10" aria-hidden="true" tabindex="-1"></a>                  ) <span class="sc">%&gt;%</span></span>
<span id="cb148-11"><a href="analysis.html#cb148-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate_at</span>(<span class="fu">vars</span>(adm1NameLat), <span class="sc">~</span><span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="st">&quot;Total&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-12"><a href="analysis.html#cb148-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(., <span class="sc">-</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_se&quot;</span>))) <span class="sc">%&gt;%</span>  <span class="co">#remove the colums with the variance type calculations</span></span>
<span id="cb148-13"><a href="analysis.html#cb148-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span> . <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-14"><a href="analysis.html#cb148-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate_if</span>(is.numeric, round, <span class="dv">2</span>)</span>
<span id="cb148-15"><a href="analysis.html#cb148-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-16"><a href="analysis.html#cb148-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-17"><a href="analysis.html#cb148-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(weighted_table)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 11
##   adm1NameLat b10_hohh_vulnerability.no b10_hohh_vulnerabilit~ b10_hohh_vulnera~
##   &lt;chr&gt;                           &lt;dbl&gt;                  &lt;dbl&gt;             &lt;dbl&gt;
## 1 Donetska                         30.0                   9.7               8.88
## 2 Luhanska                         15.2                   9.88              9.63
## 3 Total                            26.4                   9.74              9.07
## # ... with 7 more variables: b10_hohh_vulnerability.veteran_of_war_ato &lt;dbl&gt;,
## #   b10_hohh_vulnerability.single_parent &lt;dbl&gt;,
## #   b10_hohh_vulnerability.family_with_3_or_more_children &lt;dbl&gt;,
## #   b10_hohh_vulnerability.family_with_foster_children &lt;dbl&gt;,
## #   b10_hohh_vulnerability.other_specify &lt;dbl&gt;,
## #   b10_hohh_vulnerability.chronic_illness &lt;dbl&gt;,
## #   b10_hohh_vulnerability.older_person &lt;dbl&gt;</code></pre>
</div>
<div id="numeric-variables" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Numeric variables</h3>
<p>srvyr treats the calculation/aggregation of numeric variables differently in an attempt to mirror dplyr syntax</p>
<p>to calculate the mean and median expenditure in dplyr you would likely do the following</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="analysis.html#cb150-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="analysis.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb150-3"><a href="analysis.html#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_expenditure=</span> <span class="fu">mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb150-4"><a href="analysis.html#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_expenditure=</span><span class="fu">median</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb150-5"><a href="analysis.html#cb150-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   mean_expenditure median_expenditure
##              &lt;dbl&gt;              &lt;dbl&gt;
## 1            5129.               4000</code></pre>
<p>If you wanted to subset this by another variable in dplyr you would add the group_by argument</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="analysis.html#cb152-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="analysis.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata) <span class="sc">%&gt;%</span> </span>
<span id="cb152-3"><a href="analysis.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb152-4"><a href="analysis.html#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_expenditure=</span> <span class="fu">mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb152-5"><a href="analysis.html#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_expenditure=</span><span class="fu">median</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb152-6"><a href="analysis.html#cb152-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   strata     mean_expenditure median_expenditure
##   &lt;chr&gt;                 &lt;dbl&gt;              &lt;dbl&gt;
## 1 20km_rural            5488.               4000
## 2 20km_urban            6208.               5000
## 3 5km_rural             3919.               3075
## 4 5km_urban             4942.               4000</code></pre>
<p>This is the reason why the syntax also varies between categorical and numeric variables in srvyr. Therefore, to do the same using srvyr you would do the following (with a survey object). Note that due to this difference in syntax the na.rm argument works for numeric variables, but <strong>does not work</strong> for categorical variables. This was modified when srvyr was updated from v 0.3.8</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="analysis.html#cb154-1" aria-hidden="true" tabindex="-1"></a>dfsvy <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="analysis.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb154-3"><a href="analysis.html#cb154-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">mean=</span> <span class="fu">survey_mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T,<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>),</span>
<span id="cb154-4"><a href="analysis.html#cb154-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##       mean mean_low mean_upp
## 1 5128.962 4891.389 5366.536</code></pre>
<p>similar to dplyr you can easily add a group_by argument to add a subset calculation</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="analysis.html#cb156-1" aria-hidden="true" tabindex="-1"></a>dfsvy <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="analysis.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata) <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="analysis.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb156-4"><a href="analysis.html#cb156-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">mean=</span> <span class="fu">survey_mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T,<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>),</span>
<span id="cb156-5"><a href="analysis.html#cb156-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   strata      mean mean_low mean_upp
##   &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 20km_rural 5488.    4980.    5996.
## 2 20km_urban 6208.    5661.    6756.
## 3 5km_rural  3919.    3469.    4370.
## 4 5km_urban  4942.    4604.    5280.</code></pre>
</div>
</div>
<div id="butter-survey_collapse" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> butteR survey_collapse</h2>
<p>The survey_collapse function available in butteR aggregates both categorical and numerical columns of a srvyr object. It provides a standardized format output that includes mean/pct mean (point estimates), and the upper/lower confidence intervals along with the unweighted number/frequency for each response option. The survey_collapse function is built around the great srvyr package. The srvyr package is a more modern/tidyverse style wrapper for the survey package. Both the srvyr and survye packages are great and there use is highligh encouraged.</p>
<p>The main advantages of survey_collapse</p>
<ol style="list-style-type: decimal">
<li>The standardized output produced</li>
<li>Ability to analyze both categorical and numerical columns with a consistent syntax</li>
<li>Batch analyses and ability to perform many different subsetting investigations with ease</li>
</ol>
<p>Below is an example of its use.</p>
<p>First we must read in some data and make it into a srvyr object</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="analysis.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="do">###makes some additions. </span></span>
<span id="cb158-2"><a href="analysis.html#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb158-3"><a href="analysis.html#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(butteR)</span>
<span id="cb158-4"><a href="analysis.html#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb158-5"><a href="analysis.html#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb158-6"><a href="analysis.html#cb158-6" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>)</span>
<span id="cb158-7"><a href="analysis.html#cb158-7" aria-hidden="true" tabindex="-1"></a>dfsvy<span class="ot">&lt;-</span><span class="fu">as_survey</span>(df)</span></code></pre></div>
<p>For the purpose of the example I next choose a variety of different column types to analyze. As you can see I have selected select_one (categorical), select_multiple (binary categorical), and numerical columns. I then put these all into one vector.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="analysis.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here are some random concatenated select multiple parent questions</span></span>
<span id="cb159-2"><a href="analysis.html#cb159-2" aria-hidden="true" tabindex="-1"></a>select_multiple_parent_cols<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>,</span>
<span id="cb159-3"><a href="analysis.html#cb159-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>)</span>
<span id="cb159-4"><a href="analysis.html#cb159-4" aria-hidden="true" tabindex="-1"></a>numeric_cols<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb159-5"><a href="analysis.html#cb159-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;b5_age&quot;</span>)</span>
<span id="cb159-6"><a href="analysis.html#cb159-6" aria-hidden="true" tabindex="-1"></a>select_one_cols<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b9_hohh_marital_status&quot;</span>,</span>
<span id="cb159-7"><a href="analysis.html#cb159-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>)</span>
<span id="cb159-8"><a href="analysis.html#cb159-8" aria-hidden="true" tabindex="-1"></a>mixed_columns<span class="ot">&lt;-</span> <span class="fu">c</span>(select_multiple_parent_cols, numeric_cols, select_one_cols)</span></code></pre></div>
<p>A nice feature of the standardized output produced by survey_collapse is that you can perform variety of different types of analyses and then bind them together into one dataframe/tibble.</p>
<p>Therefore I fill an empty list with analysis to facilitate binding later. For the first analyses I simply aggregate all the columns specified as mean/pct mean. I next analyze the same variable but this time subset/disaggreated by the strata column. It’s a good idea to mutate an extra column indicating what exact analysis was done so that when they are binded together later they can more easily be manipulated</p>
<p><strong>note: I am commenting this section as it seems to break with the latest update</strong></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="analysis.html#cb160-1" aria-hidden="true" tabindex="-1"></a>outputs<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb160-2"><a href="analysis.html#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="analysis.html#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co"># outputs$overall&lt;-butteR::survey_collapse(df = dfsvy,vars_to_analyze = mixed_columns) %&gt;% </span></span>
<span id="cb160-4"><a href="analysis.html#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(analysis_level= &quot;overall&quot;)</span></span>
<span id="cb160-5"><a href="analysis.html#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb160-6"><a href="analysis.html#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="co"># outputs$strata&lt;-butteR::survey_collapse(df = dfsvy,vars_to_analyze = mixed_columns,disag = &quot;strata&quot;) %&gt;% </span></span>
<span id="cb160-7"><a href="analysis.html#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(analysis_level= &quot;strata&quot;)</span></span></code></pre></div>
<p>Here is an example of what the long format data looks like as a table.</p>
<p>This is a great format for manipulating/filtering and then graphing with ggplot</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="analysis.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output_df&lt;- bind_rows(outputs)</span></span>
<span id="cb161-2"><a href="analysis.html#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb161-3"><a href="analysis.html#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="co"># output_df %&gt;% </span></span>
<span id="cb161-4"><a href="analysis.html#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(analysis_level==&quot;overall&quot;) %&gt;% </span></span>
<span id="cb161-5"><a href="analysis.html#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(question_val= paste0(variable,&quot;.&quot;,variable_val)) %&gt;% </span></span>
<span id="cb161-6"><a href="analysis.html#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x= question_val,y= `mean/pct`))+</span></span>
<span id="cb161-7"><a href="analysis.html#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(stat=&quot;identity&quot;, position = position_dodge(width = 0.3))+</span></span>
<span id="cb161-8"><a href="analysis.html#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_errorbar(aes(ymin= `mean/pct_low`, ymax= `mean/pct_upp`), </span></span>
<span id="cb161-9"><a href="analysis.html#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                 width=0.2,position = position_dodge(width = 0.3))+</span></span>
<span id="cb161-10"><a href="analysis.html#cb161-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(labels = scales::percent,breaks = seq(0,1,by=0.1))+</span></span>
<span id="cb161-11"><a href="analysis.html#cb161-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_flip()+</span></span>
<span id="cb161-12"><a href="analysis.html#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw()+</span></span>
<span id="cb161-13"><a href="analysis.html#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb161-14"><a href="analysis.html#cb161-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.title = element_blank(),</span></span>
<span id="cb161-15"><a href="analysis.html#cb161-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.text.x = element_text(angle=90),</span></span>
<span id="cb161-16"><a href="analysis.html#cb161-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.title= element_blank()</span></span>
<span id="cb161-17"><a href="analysis.html#cb161-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span>
<span id="cb161-18"><a href="analysis.html#cb161-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb161-19"><a href="analysis.html#cb161-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb161-20"><a href="analysis.html#cb161-20" aria-hidden="true" tabindex="-1"></a><span class="co"># # Easy to plot subset findings as well!</span></span>
<span id="cb161-21"><a href="analysis.html#cb161-21" aria-hidden="true" tabindex="-1"></a><span class="co"># output_df %&gt;% </span></span>
<span id="cb161-22"><a href="analysis.html#cb161-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(analysis_level==&quot;strata&quot;) %&gt;% </span></span>
<span id="cb161-23"><a href="analysis.html#cb161-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(question_val= paste0(variable,&quot;.&quot;,variable_val)) %&gt;% </span></span>
<span id="cb161-24"><a href="analysis.html#cb161-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x= question_val,y= `mean/pct`, color=subset_1_val))+</span></span>
<span id="cb161-25"><a href="analysis.html#cb161-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(stat=&quot;identity&quot;, position = position_dodge(width = 0.3))+</span></span>
<span id="cb161-26"><a href="analysis.html#cb161-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_errorbar(aes(ymin= `mean/pct_low`, ymax= `mean/pct_upp`), </span></span>
<span id="cb161-27"><a href="analysis.html#cb161-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                 width=0.2,position = position_dodge(width = 0.3))+</span></span>
<span id="cb161-28"><a href="analysis.html#cb161-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(labels = scales::percent,breaks = seq(0,1,by=0.1))+</span></span>
<span id="cb161-29"><a href="analysis.html#cb161-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_flip()+</span></span>
<span id="cb161-30"><a href="analysis.html#cb161-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw()+</span></span>
<span id="cb161-31"><a href="analysis.html#cb161-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb161-32"><a href="analysis.html#cb161-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.title = element_blank(),</span></span>
<span id="cb161-33"><a href="analysis.html#cb161-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.text.x = element_text(angle=90),</span></span>
<span id="cb161-34"><a href="analysis.html#cb161-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.title= element_blank()</span></span>
<span id="cb161-35"><a href="analysis.html#cb161-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span></code></pre></div>
<div id="select_one" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> select_one</h3>
</div>
<div id="select_mutiple" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> select_mutiple</h3>
</div>
</div>
<div id="analysis-with-numerical-variables" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Analysis with numerical variables</h2>
<div id="averages" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Averages</h3>
<p>###Summarytools (CRAN package)</p>
<p>###hypegrammaR / koboquest / butteR</p>
</div>
<div id="median" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Median</h3>
<p>####Spatstat
<a href="https://cran.r-project.org/web/packages/spatstat/index.html">Spatstat</a> - library with set of different functions for analyzing Spatial Point Patterns but also quite useful for analysis of weighted data.</p>
<p>At first let’s select all numerical variables from the dataset using Kobo questionnaire and dataset. It can be done with the following custom function:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="analysis.html#cb162-1" aria-hidden="true" tabindex="-1"></a>select_numerical <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, kobo){</span>
<span id="cb162-2"><a href="analysis.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  kobo_questions <span class="ot">&lt;-</span> kobo[<span class="fu">grepl</span>(<span class="st">&quot;integer|decimal|calculate&quot;</span>, kobo<span class="sc">$</span>type),<span class="fu">c</span>(<span class="st">&quot;type&quot;</span>,<span class="st">&quot;name&quot;</span>)]</span>
<span id="cb162-3"><a href="analysis.html#cb162-3" aria-hidden="true" tabindex="-1"></a>  names.use <span class="ot">&lt;-</span> <span class="fu">names</span>(dataset)[(<span class="fu">names</span>(dataset) <span class="sc">%in%</span> <span class="fu">as.character</span>(kobo_questions<span class="sc">$</span>name))]</span>
<span id="cb162-4"><a href="analysis.html#cb162-4" aria-hidden="true" tabindex="-1"></a>  numerical <span class="ot">&lt;-</span> dataset[,<span class="fu">c</span>(names.use,<span class="st">&quot;X_uuid&quot;</span>,<span class="st">&#39;strata&#39;</span>,<span class="st">&#39;stratum.weight&#39;</span>)] <span class="co">#Here we can select any other relevant variables</span></span>
<span id="cb162-5"><a href="analysis.html#cb162-5" aria-hidden="true" tabindex="-1"></a>  numerical[names.use] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(numerical[names.use], gsub, <span class="at">pattern =</span> <span class="st">&#39;NA&#39;</span>, <span class="at">replacement =</span> <span class="cn">NA</span>)</span>
<span id="cb162-6"><a href="analysis.html#cb162-6" aria-hidden="true" tabindex="-1"></a>  numerical[names.use] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(numerical[names.use], as.numeric)</span>
<span id="cb162-7"><a href="analysis.html#cb162-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(numerical)</span>
<span id="cb162-8"><a href="analysis.html#cb162-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-9"><a href="analysis.html#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="analysis.html#cb162-10" aria-hidden="true" tabindex="-1"></a>numerical_questions <span class="ot">&lt;-</span> <span class="fu">select_numerical</span>(main_dataset, questions)</span>
<span id="cb162-11"><a href="analysis.html#cb162-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-12"><a href="analysis.html#cb162-12" aria-hidden="true" tabindex="-1"></a>numerical_classes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(numerical_questions[,<span class="dv">1</span><span class="sc">:</span><span class="fu">c</span>(<span class="fu">ncol</span>(numerical_questions)<span class="sc">-</span><span class="dv">3</span>)], class) <span class="co">#Here we can check class of each selected variable</span></span>
<span id="cb162-13"><a href="analysis.html#cb162-13" aria-hidden="true" tabindex="-1"></a>numerical_classes <span class="ot">&lt;-</span> numerical_classes[<span class="st">&quot;character&quot;</span> <span class="sc">%in%</span> numerical_classes] <span class="co">#and here we check if any variable has class &quot;character&quot;</span></span>
<span id="cb162-14"><a href="analysis.html#cb162-14" aria-hidden="true" tabindex="-1"></a>numerical_questions <span class="ot">&lt;-</span> numerical_questions[ , <span class="sc">!</span><span class="fu">names</span>(numerical_questions) <span class="sc">%in%</span> numerical_classes] <span class="co">#if any variable has a character class then we remove it</span></span>
<span id="cb162-15"><a href="analysis.html#cb162-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(numerical_classes)<span class="co">#and here we removing vector with classes from our environment</span></span></code></pre></div>
<p>Now let’s calculate weighted median for “n1_HH_total_expenditure”.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="analysis.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.median</span>(numerical_questions<span class="sc">$</span>n1_HH_total_expenditure, numerical_questions<span class="sc">$</span>stratum.weight, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4150</code></pre>
<p>But if we want to calculate weighted medians for each variable we will need to iterate this function on those variables. But first we will need to exclude variables with less than 3 observations.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="analysis.html#cb165-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> numerical_questions <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="analysis.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>X_uuid, <span class="sc">-</span>strata) <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="analysis.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="at">.fns=</span> <span class="sc">~</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)) ))<span class="sc">%&gt;%</span></span>
<span id="cb165-4"><a href="analysis.html#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>()<span class="co">#Calculating count of observation for each variable</span></span>
<span id="cb165-5"><a href="analysis.html#cb165-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-6"><a href="analysis.html#cb165-6" aria-hidden="true" tabindex="-1"></a>numerical_questions <span class="ot">&lt;-</span> numerical_questions[ , (<span class="fu">names</span>(numerical_questions) <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">subset</span>(counts, counts[,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">3</span>)))]</span>
<span id="cb165-7"><a href="analysis.html#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co">#removing variables with less than 3 observations</span></span>
<span id="cb165-8"><a href="analysis.html#cb165-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-9"><a href="analysis.html#cb165-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-10"><a href="analysis.html#cb165-10" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">lapply</span>(numerical_questions[<span class="dv">1</span><span class="sc">:</span><span class="dv">46</span>], weighted.median, <span class="at">w =</span> numerical_questions<span class="sc">$</span>stratum.weight, <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb165-11"><a href="analysis.html#cb165-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<p>Now we can transpond resulting vector and add description to the calculation</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="analysis.html#cb166-1" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(medians),<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb166-2"><a href="analysis.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(medians)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Median_wght&quot;</span></span>
<span id="cb166-3"><a href="analysis.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(medians)</span></code></pre></div>
<pre><code>##                               Median_wght
## b15_hohh_income                    2780.0
## hohh_age_18                           0.0
## age_18                                0.0
## b21_num_additional_hh_members         0.5
## age_5_18_number                       0.0
## age_5_12_number                       0.0</code></pre>
</div>
</div>
<div id="ratios" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Ratios</h2>
<p>This function computes the % of answers for select multiple questions.<br />
The output can be used as a data merge file for indesign.<br />
The arguments are: dataset, disaggregation variable, question to analyze, and weight column.<br />
</p>
<div id="example1" class="section level3" number="7.5.1">
<h3 number="7.5.1"><span class="header-section-number">7.5.1</span> Example1:<br />
</h3>
<p><strong>Question</strong>: e11_items_do_not_have_per_hh<br />
<strong>Disaggregation variable</strong>: b9_hohh_marital_status<br />
<strong>weights column</strong>: stratum.weight<br />
</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="analysis.html#cb168-1" aria-hidden="true" tabindex="-1"></a>ratios_select_multiple <span class="ot">&lt;-</span></span>
<span id="cb168-2"><a href="analysis.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(df, x_var, y_prefix, weights_var) {</span>
<span id="cb168-3"><a href="analysis.html#cb168-3" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">%&gt;%</span></span>
<span id="cb168-4"><a href="analysis.html#cb168-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>({</span>
<span id="cb168-5"><a href="analysis.html#cb168-5" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb168-6"><a href="analysis.html#cb168-6" aria-hidden="true" tabindex="-1"></a>          x_var</span>
<span id="cb168-7"><a href="analysis.html#cb168-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb168-8"><a href="analysis.html#cb168-8" aria-hidden="true" tabindex="-1"></a>      }) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(y_prefix)) <span class="sc">%&gt;%</span></span>
<span id="cb168-9"><a href="analysis.html#cb168-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="fu">paste0</span>(y_prefix, <span class="st">&quot;.&quot;</span>)),</span>
<span id="cb168-10"><a href="analysis.html#cb168-10" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="at">pct =</span> <span class="sc">~</span> <span class="fu">weighted.mean</span>(., {</span>
<span id="cb168-11"><a href="analysis.html#cb168-11" aria-hidden="true" tabindex="-1"></a>                         {</span>
<span id="cb168-12"><a href="analysis.html#cb168-12" aria-hidden="true" tabindex="-1"></a>                           weights_var</span>
<span id="cb168-13"><a href="analysis.html#cb168-13" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb168-14"><a href="analysis.html#cb168-14" aria-hidden="true" tabindex="-1"></a>                       }, <span class="at">na.rm =</span> T))))</span>
<span id="cb168-15"><a href="analysis.html#cb168-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb168-16"><a href="analysis.html#cb168-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-17"><a href="analysis.html#cb168-17" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span></span>
<span id="cb168-18"><a href="analysis.html#cb168-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ratios_select_multiple</span>(</span>
<span id="cb168-19"><a href="analysis.html#cb168-19" aria-hidden="true" tabindex="-1"></a>    main_dataset,</span>
<span id="cb168-20"><a href="analysis.html#cb168-20" aria-hidden="true" tabindex="-1"></a>    b9_hohh_marital_status,</span>
<span id="cb168-21"><a href="analysis.html#cb168-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;e11_items_do_not_have_per_hh&quot;</span>,</span>
<span id="cb168-22"><a href="analysis.html#cb168-22" aria-hidden="true" tabindex="-1"></a>    stratum.weight</span>
<span id="cb168-23"><a href="analysis.html#cb168-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb168-24"><a href="analysis.html#cb168-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-25"><a href="analysis.html#cb168-25" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   b9_hohh_marital_st~ e11_items_do_not_h~ e11_items_do_not_~ e11_items_do_not_h~
##   &lt;chr&gt;                             &lt;dbl&gt;              &lt;dbl&gt;               &lt;dbl&gt;
## 1 divorced                         0.0851             0.0859               0.393
## 2 married                          0.0496             0.0545               0.409
## 3 separated_married_~              0.0138             0.0513               0.443
## 4 single                           0.0726             0.0516               0.457
## 5 unmarried_but_livi~              0.0874             0.101                0.293
## 6 widowed                          0.106              0.0923               0.504
## # ... with 1 more variable:
## #   e11_items_do_not_have_per_hh.hh_has_all_items_pct &lt;dbl&gt;</code></pre>
</div>
<div id="example2---analyzing-multiple-questions-and-combine-the-output" class="section level3" number="7.5.2">
<h3 number="7.5.2"><span class="header-section-number">7.5.2</span> Example2 - Analyzing multiple questions and combine the output:<br />
</h3>
<p><strong>Question</strong>: e11_items_do_not_have_per_hh and b11_hohh_chronic_illness<br />
<strong>Disaggregation variable</strong>: b9_hohh_marital_status<br />
<strong>weights column</strong>: stratum.weight<br />
</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="analysis.html#cb170-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span></span>
<span id="cb170-2"><a href="analysis.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(<span class="st">&quot;full_join&quot;</span>, <span class="fu">map</span>(</span>
<span id="cb170-3"><a href="analysis.html#cb170-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;e11_items_do_not_have_per_hh&quot;</span>, <span class="st">&quot;b11_hohh_chronic_illness&quot;</span>),</span>
<span id="cb170-4"><a href="analysis.html#cb170-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ratios_select_multiple</span>(main_dataset, b9_hohh_marital_status, .x, stratum.weight)</span>
<span id="cb170-5"><a href="analysis.html#cb170-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## Joining, by = &quot;b9_hohh_marital_status&quot;</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="analysis.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 18
##   b9_hohh_marital_st~ e11_items_do_not_h~ e11_items_do_not_~ e11_items_do_not_h~
##   &lt;chr&gt;                             &lt;dbl&gt;              &lt;dbl&gt;               &lt;dbl&gt;
## 1 divorced                         0.0851             0.0859               0.393
## 2 married                          0.0496             0.0545               0.409
## 3 separated_married_~              0.0138             0.0513               0.443
## 4 single                           0.0726             0.0516               0.457
## 5 unmarried_but_livi~              0.0874             0.101                0.293
## 6 widowed                          0.106              0.0923               0.504
## # ... with 14 more variables:
## #   e11_items_do_not_have_per_hh.hh_has_all_items_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.blood_pressure_diseases_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.cardiovascular_disease_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.diabetes_need_insulin_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.diabetes_does_not_need_insulin_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.chronic_respiratory_condition_pct &lt;dbl&gt;, ...</code></pre>
</div>
<div id="example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted" class="section level3" number="7.5.3">
<h3 number="7.5.3"><span class="header-section-number">7.5.3</span> Example3 - No dissagregation is needed and/or the data is not weighted:<br />
</h3>
<p><strong>Question</strong>: e11_items_do_not_have_per_hh and b11_hohh_chronic_illness<br />
<strong>Disaggregation variable</strong>: NA<br />
<strong>weights column</strong>: NA<br />
</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="analysis.html#cb174-1" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>all <span class="ot">&lt;-</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb174-2"><a href="analysis.html#cb174-2" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>no_weights <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb174-3"><a href="analysis.html#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="analysis.html#cb174-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span></span>
<span id="cb174-5"><a href="analysis.html#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(<span class="st">&quot;full_join&quot;</span>, <span class="fu">map</span>(</span>
<span id="cb174-6"><a href="analysis.html#cb174-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;e11_items_do_not_have_per_hh&quot;</span>, <span class="st">&quot;b11_hohh_chronic_illness&quot;</span>),</span>
<span id="cb174-7"><a href="analysis.html#cb174-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ratios_select_multiple</span>(main_dataset, all, .x, no_weights)</span>
<span id="cb174-8"><a href="analysis.html#cb174-8" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## Joining, by = &quot;all&quot;</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="analysis.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 18
##   all   e11_items_do_not_~ e11_items_do_not~ e11_items_do_not~ e11_items_do_not~
##   &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
## 1 all               0.0804            0.0779             0.417             0.515
## # ... with 13 more variables:
## #   b11_hohh_chronic_illness.blood_pressure_diseases_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.cardiovascular_disease_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.diabetes_need_insulin_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.diabetes_does_not_need_insulin_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.chronic_respiratory_condition_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.musculoskeletal_system_and_joints_pct &lt;dbl&gt;, ...</code></pre>
</div>
</div>
<div id="weights" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Weights</h2>
<p>surveyweights
survey (CRAN package)
srvyr (CRAN package)</p>
</div>
<div id="repeating-the-above" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Repeating the above</h2>
</div>
<div id="analysis---top-x-ranking-select-one-and-select-multiple" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Analysis - top X / ranking (select one and select multiple)</h2>
<p>First: select_one question</p>
<p>The indicator of interest is <strong>e1_shelter_type</strong> and the options are:</p>
<ul>
<li>solid_finished_house</li>
<li>solid_finished_apartment</li>
<li>unfinished_nonenclosed_building</li>
<li>collective_shelter</li>
<li>tent</li>
<li>makeshift_shelter</li>
<li>none_sleeping_in_open</li>
<li>other_specify</li>
<li>dont_know_refuse_to_answer</li>
</ul>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="analysis.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top X/ranking for select_one type questions </span></span>
<span id="cb178-2"><a href="analysis.html#cb178-2" aria-hidden="true" tabindex="-1"></a>select_one_topX <span class="ot">&lt;-</span> <span class="cf">function</span>(df, question_name, <span class="at">X =</span> <span class="dv">3</span>) { <span class="co"># by default return top 3</span></span>
<span id="cb178-3"><a href="analysis.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test message</span></span>
<span id="cb178-4"><a href="analysis.html#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">colnames</span>(df)[<span class="fu">grepl</span>(question_name, <span class="fu">colnames</span>(df), <span class="at">fixed =</span> T)]) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb178-5"><a href="analysis.html#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;question name:&quot;</span>, question_name, <span class="st">&quot;doesn&#39;t exist in the main dataset. Please double check and make required changes!&quot;</span>)))</span>
<span id="cb178-6"><a href="analysis.html#cb178-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb178-7"><a href="analysis.html#cb178-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-8"><a href="analysis.html#cb178-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb178-9"><a href="analysis.html#cb178-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name))<span class="sc">%&gt;%</span>          </span>
<span id="cb178-10"><a href="analysis.html#cb178-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name))) <span class="sc">%&gt;%</span> <span class="co"># remove NA values from percentage calculations </span></span>
<span id="cb178-11"><a href="analysis.html#cb178-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(question_name, as.factor) <span class="sc">%&gt;%</span>  <span class="co"># added to have all groups</span></span>
<span id="cb178-12"><a href="analysis.html#cb178-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name), <span class="at">.drop=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb178-13"><a href="analysis.html#cb178-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb178-14"><a href="analysis.html#cb178-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">percentages =</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb178-15"><a href="analysis.html#cb178-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(percentages)) <span class="sc">%&gt;%</span> </span>
<span id="cb178-16"><a href="analysis.html#cb178-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(question_name, as.character) <span class="sc">%&gt;%</span> </span>
<span id="cb178-17"><a href="analysis.html#cb178-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(X)   <span class="co"># keep top X percentages only </span></span>
<span id="cb178-18"><a href="analysis.html#cb178-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-19"><a href="analysis.html#cb178-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(df) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">warning</span>(<span class="st">&quot;None of the choices was selected!&quot;</span>)</span>
<span id="cb178-20"><a href="analysis.html#cb178-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb178-21"><a href="analysis.html#cb178-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb178-22"><a href="analysis.html#cb178-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb178-23"><a href="analysis.html#cb178-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-24"><a href="analysis.html#cb178-24" aria-hidden="true" tabindex="-1"></a><span class="co"># return top 4 shelter types</span></span>
<span id="cb178-25"><a href="analysis.html#cb178-25" aria-hidden="true" tabindex="-1"></a>shelter_type_top4 <span class="ot">&lt;-</span> <span class="fu">select_one_topX</span>(<span class="at">df =</span> main_dataset, <span class="at">question_name =</span> <span class="st">&quot;e1_shelter_type&quot;</span>, <span class="at">X =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>Second: select_multiple question</p>
<p>The indicator of interest is <strong>e3_shelter_enclosure_issues</strong> and the options are:</p>
<ul>
<li>no_issues</li>
<li>lack_of_insulation_from_cold</li>
<li>leaks_during_light_rain_snow</li>
<li>leaks_during_heavy_rain_snow</li>
<li>limited_ventilation_less_than_05m2_ventilation_in_each_room_including_kitchen</li>
<li>presence_of_dirt_or_debris_removable</li>
<li>presence_of_dirt_or_debris_nonremovable</li>
<li>none_of_the_above</li>
<li>other_specify</li>
<li>dont_know</li>
</ul>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="analysis.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top X/ranking for select_multiple type questions</span></span>
<span id="cb179-2"><a href="analysis.html#cb179-2" aria-hidden="true" tabindex="-1"></a>select_multiple_topX <span class="ot">&lt;-</span> <span class="cf">function</span>(df, question_name, <span class="at">X =</span> <span class="dv">3</span>) {</span>
<span id="cb179-3"><a href="analysis.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test message</span></span>
<span id="cb179-4"><a href="analysis.html#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">colnames</span>(df)[<span class="fu">grepl</span>(question_name, <span class="fu">colnames</span>(df), <span class="at">fixed =</span> T)]) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb179-5"><a href="analysis.html#cb179-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;question name:&quot;</span>, question_name, <span class="st">&quot;doesn&#39;t exist in the main dataset. Please double check and make required changes!&quot;</span>)))</span>
<span id="cb179-6"><a href="analysis.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-7"><a href="analysis.html#cb179-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-8"><a href="analysis.html#cb179-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb179-9"><a href="analysis.html#cb179-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">colnames</span>(df)[<span class="fu">grepl</span>(<span class="fu">paste0</span>(question_name, <span class="st">&quot;.&quot;</span>), <span class="fu">colnames</span>(df), <span class="at">fixed =</span> T)])</span>
<span id="cb179-10"><a href="analysis.html#cb179-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-11"><a href="analysis.html#cb179-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if question was not answered</span></span>
<span id="cb179-12"><a href="analysis.html#cb179-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(df))) <span class="fu">warning</span>(<span class="st">&quot;None of the choices was selected!&quot;</span>)</span>
<span id="cb179-13"><a href="analysis.html#cb179-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-14"><a href="analysis.html#cb179-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keeping only the options names in the colnames</span></span>
<span id="cb179-15"><a href="analysis.html#cb179-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="fu">paste0</span>(question_name, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>), <span class="st">&quot;&quot;</span>, <span class="fu">colnames</span>(df))</span>
<span id="cb179-16"><a href="analysis.html#cb179-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-17"><a href="analysis.html#cb179-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate top X percentages</span></span>
<span id="cb179-18"><a href="analysis.html#cb179-18" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb179-19"><a href="analysis.html#cb179-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_all</span>(as.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb179-20"><a href="analysis.html#cb179-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> question_name, <span class="at">values_to =</span> <span class="st">&quot;choices&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb179-21"><a href="analysis.html#cb179-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name), <span class="at">.drop=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb179-22"><a href="analysis.html#cb179-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(choices, <span class="at">na.rm =</span> T),</span>
<span id="cb179-23"><a href="analysis.html#cb179-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">percentages =</span> <span class="fu">round</span>(<span class="fu">sum</span>(choices, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">n</span>() <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove NA values from percentages calculations</span></span>
<span id="cb179-24"><a href="analysis.html#cb179-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(percentages)) <span class="sc">%&gt;%</span> </span>
<span id="cb179-25"><a href="analysis.html#cb179-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(X)   <span class="co"># keep top X percentages only </span></span>
<span id="cb179-26"><a href="analysis.html#cb179-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-27"><a href="analysis.html#cb179-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb179-28"><a href="analysis.html#cb179-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-29"><a href="analysis.html#cb179-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-30"><a href="analysis.html#cb179-30" aria-hidden="true" tabindex="-1"></a><span class="co"># return top 7 shelter enclosure issues</span></span>
<span id="cb179-31"><a href="analysis.html#cb179-31" aria-hidden="true" tabindex="-1"></a>shelter_enclosure_issues_top7 <span class="ot">&lt;-</span> <span class="fu">select_multiple_topX</span>(<span class="at">df =</span> main_dataset, <span class="at">question_name =</span> <span class="st">&quot;e3_shelter_enclosure_issues&quot;</span>, <span class="at">X =</span> <span class="dv">7</span>)</span></code></pre></div>
</div>
<div id="borda-count" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Borda count</h2>
</div>
<div id="hypothesis-testing" class="section level2" number="7.10">
<h2><span class="header-section-number">7.10</span> Hypothesis testing</h2>
<div id="t-test" class="section level3" number="7.10.1">
<h3><span class="header-section-number">7.10.1</span> T-test</h3>
</div>
<div id="anova" class="section level3" number="7.10.2">
<h3><span class="header-section-number">7.10.2</span> ANOVA</h3>
</div>
<div id="chi-squares" class="section level3" number="7.10.3">
<h3><span class="header-section-number">7.10.3</span> chi-squares</h3>
<p>Pearson`s chi-squared test.
Chi-squared test is a statistical hypothesis test, based on comparing expected and observed frequencies of 2-way distribution (2-way table).</p>
<p>There are three types of tests (hypothesis) that could be tested with chi-squared: independence of variables, homogenity of distribution of the characteristic across “stratas” and goodness of fit (whether the actual distribution is different from the hypothetical one). Two former versions use the same calculation.</p>
<p>Chi-squared test is a non-parametric test.
It is used with nominal to nominal (nominal to ordinal) scales.
For running chi-squared test, each cell of the crosstab should contain at least 5 observations.</p>
<p>Note, that chi-squared test indicates significance of differences in values on a <em>table level</em>. Thus, it is impossible to track significance in differences for particular options.</p>
<p>(For example, it is possible to say that satisfaction with public transport and living in urban / rural areas are connected. However, we can conclude from the test itself, that “satisfied” and “dissatisfied” options differ, while “indifferent” does not. By the way, it is possible to come up with this conclusion while interpreting a corresponding crosstab. Also, chi-squared test can tell nothing about the strength and the direction of a liaison between variables).</p>
<div id="chi-squared-test-for-independence" class="section level4" number="7.10.3.1">
<h4><span class="header-section-number">7.10.3.1</span> Chi-squared test for independence</h4>
<p>The test for weighted data is being run with the survey library</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="analysis.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb180-2"><a href="analysis.html#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb180-3"><a href="analysis.html#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(weights)</span></code></pre></div>
<p>The use of the survey package functions requires specifying survey design object (which reslects sampling approach).</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="analysis.html#cb181-1" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb181-2"><a href="analysis.html#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="analysis.html#cb181-3" aria-hidden="true" tabindex="-1"></a>svy_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">data=</span>main_dataset, </span>
<span id="cb181-4"><a href="analysis.html#cb181-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb181-5"><a href="analysis.html#cb181-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">strata =</span> main_dataset<span class="sc">$</span>strata, </span>
<span id="cb181-6"><a href="analysis.html#cb181-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">probs =</span> <span class="cn">NULL</span>,</span>
<span id="cb181-7"><a href="analysis.html#cb181-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights =</span> main_dataset<span class="sc">$</span>stratum.weight)</span></code></pre></div>
<p>Specifying function for getting chi-squared outputs.</p>
<p>Hereby test Chi^2 test of independence is used. So, the test is performed to find out if strata variable and target variable are independent,
<strong>H0</strong> - the distribution of target variable values is equal across all stratas
<strong>H1</strong> - strata and target var are not independent, so distribution varies across stratas.</p>
<p>Apart from getting test statistic and p value, we would like to detect manually what are the biggest and the smallest values across groups/stratas (in case if the difference is significant and it makes sense to do it).</p>
<p>Hereby test Chi^2 test of independence is used. So, the test is performed to find out if strata variable and target variable are independent,
H0 - the distribution of target var. values is equal across all stratas
H1 - strata and target var are not independent, so distribution varies across stratas.</p>
<p>Within the Survey package, the suggested function uses Scott &amp; Rao adjustment for complex survey design</p>
<p>#####Simple single call of the test.</p>
<p>Let’s say that the research aim is to understand whether the main water source is dependent on the area where HH lives (strata variable).</p>
<p>Thus, in our case:
H0 - the distribution of water source is equal across stratas and these variables are independent
H1 - the distribution of water source differs by strata and these variables are not independent.</p>
<p>Running the chi-squared test:</p>
<p>(Survey version - requires a survey design object)</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="analysis.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svychisq</span>(<span class="sc">~</span> f11_dinking_water_source <span class="sc">+</span> strata, <span class="at">design =</span> svy_design, <span class="at">statistic =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s X^2: Rao &amp; Scott adjustment
## 
## data:  svychisq(~f11_dinking_water_source + strata, design = svy_design,     statistic = &quot;Chisq&quot;)
## X-squared = 244.62, df = 21, p-value &lt; 2.2e-16</code></pre>
<p>The current output presents the result of Pearson’s chi-squared test (Rao &amp; Scott adjustment accounts for weighted data) [<a href="https://www.researchgate.net/publication/38360147_On_Simple_Adjustments_to_Chi-Square_Tests_with_Sample_Survey_Data" class="uri">https://www.researchgate.net/publication/38360147_On_Simple_Adjustments_to_Chi-Square_Tests_with_Sample_Survey_Data</a>].</p>
<p>The output consist of three parameters:
1. X-squared - observed value of chi-squared parameter,
2. df - “degrees of freedom” or number of independent categories in data -1
Having only these two elements it is possible to see, if with the current number of df, the value of chi-squared parameter is greater than the critical value for the chosen level of probability, using (tables of chi-squared critical values) [<a href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm" class="uri">https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm</a>]
Fortunately, R provides us with the third parameter, which allows us to skip this step.
3. p-value - stands for the probability of getting value of the chi-squared parameter greater or equal to the given one assuming that H0 is true. If p-value &lt; 0.05 (for 95% confidence level, or 0.01 for 99%), the H0 can be rejected.</p>
<p>In the current example, as p-value is very low, H0 can be rejected, and hence, strata variable and drinking water source are not independent.</p>
<p>(Weights package - can work with the dataframe directly, without the survey design object)</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="analysis.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wtd.chi.sq</span>(<span class="at">var1 =</span> main_dataset<span class="sc">$</span>f11_dinking_water_source, <span class="at">var2 =</span> main_dataset<span class="sc">$</span>strata, <span class="at">weight =</span> main_dataset<span class="sc">$</span>stratum.weight)</span></code></pre></div>
<pre><code>##        Chisq           df      p.value 
## 2.446205e+02 2.100000e+01 4.928158e-40</code></pre>
<p>Specifying the function for crosstabs with chi-squared tests for independence.</p>
<p>#####Functions to have test results along with crosstabs</p>
<ol style="list-style-type: decimal">
<li>The function with survey design object.</li>
</ol>
<p>Apart from getting test statistic and p value, we would like to detect manually what are the biggest and the smallest values across groups/stratas (in case if the difference is significant and it makes sense to do it).</p>
<p>The function also helps to find out smallest and the largest values per row</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="analysis.html#cb186-1" aria-hidden="true" tabindex="-1"></a>chi2_ind_extr <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, design){</span>
<span id="cb186-2"><a href="analysis.html#cb186-2" aria-hidden="true" tabindex="-1"></a>  my_var <span class="ot">&lt;-</span> y</span>
<span id="cb186-3"><a href="analysis.html#cb186-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-4"><a href="analysis.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="co"># running Pearson&#39;s chi-squared test</span></span>
<span id="cb186-5"><a href="analysis.html#cb186-5" aria-hidden="true" tabindex="-1"></a>  s_chi <span class="ot">&lt;-</span> <span class="fu">svychisq</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;~&quot;</span>, x,<span class="st">&quot;+&quot;</span>, y)), design, <span class="at">statistic =</span> <span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb186-6"><a href="analysis.html#cb186-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb186-7"><a href="analysis.html#cb186-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extracting basic parameters</span></span>
<span id="cb186-8"><a href="analysis.html#cb186-8" aria-hidden="true" tabindex="-1"></a>  wmy_t <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(s_chi<span class="sc">$</span>observed)</span>
<span id="cb186-9"><a href="analysis.html#cb186-9" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>p <span class="ot">&lt;-</span> s_chi<span class="sc">$</span>p.value</span>
<span id="cb186-10"><a href="analysis.html#cb186-10" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>chi_adj <span class="ot">&lt;-</span> s_chi<span class="sc">$</span>statistic</span>
<span id="cb186-11"><a href="analysis.html#cb186-11" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>df <span class="ot">&lt;-</span> s_chi<span class="sc">$</span>parameter</span>
<span id="cb186-12"><a href="analysis.html#cb186-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#indicating significance</span></span>
<span id="cb186-13"><a href="analysis.html#cb186-13" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>independence <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wmy_t<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">&quot;h1&quot;</span>, <span class="st">&quot;h0&quot;</span>)</span>
<span id="cb186-14"><a href="analysis.html#cb186-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(wmy_t)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var_x&quot;</span>, <span class="st">&quot;var_y&quot;</span>)</span>
<span id="cb186-15"><a href="analysis.html#cb186-15" aria-hidden="true" tabindex="-1"></a>  wmy_t_w <span class="ot">&lt;-</span> <span class="fu">spread</span>(wmy_t, var_y, Freq)</span>
<span id="cb186-16"><a href="analysis.html#cb186-16" aria-hidden="true" tabindex="-1"></a>  wmy_t_w[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(x, <span class="st">&quot; &quot;</span>, wmy_t_w[,<span class="dv">1</span>])</span>
<span id="cb186-17"><a href="analysis.html#cb186-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(wmy_t_w)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;variable&quot;</span></span>
<span id="cb186-18"><a href="analysis.html#cb186-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># getting percent from weighted frequencies</span></span>
<span id="cb186-19"><a href="analysis.html#cb186-19" aria-hidden="true" tabindex="-1"></a>  cols_no_prop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="st">&quot;independence&quot;</span>, <span class="st">&quot;max&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;chi_adj&quot;</span>, <span class="st">&quot;df&quot;</span>)</span>
<span id="cb186-20"><a href="analysis.html#cb186-20" aria-hidden="true" tabindex="-1"></a>  wmy_t_w[, <span class="sc">!</span><span class="fu">colnames</span>(wmy_t_w) <span class="sc">%in%</span> cols_no_prop] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(wmy_t_w[, <span class="sc">!</span><span class="fu">colnames</span>(wmy_t_w) <span class="sc">%in%</span> cols_no_prop], <span class="cf">function</span>(x){x<span class="sc">/</span><span class="fu">sum</span>(x, <span class="at">na.rm =</span> T)})</span>
<span id="cb186-21"><a href="analysis.html#cb186-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># indicating extremum values</span></span>
<span id="cb186-22"><a href="analysis.html#cb186-22" aria-hidden="true" tabindex="-1"></a>  cols_to_compare <span class="ot">&lt;-</span> <span class="fu">colnames</span>(wmy_t_w)[<span class="sc">!</span><span class="fu">colnames</span>(wmy_t_w) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;chi_adj&quot;</span>, <span class="st">&quot;df&quot;</span>, <span class="st">&quot;independence&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;max&quot;</span>, <span class="st">&quot;variable&quot;</span>)]</span>
<span id="cb186-23"><a href="analysis.html#cb186-23" aria-hidden="true" tabindex="-1"></a>  wmy_t_w<span class="sc">$</span>max <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wmy_t_w<span class="sc">$</span>independence <span class="sc">==</span> <span class="st">&quot;h1&quot;</span>, cols_to_compare[<span class="fu">apply</span>(wmy_t_w, <span class="dv">1</span>, which.max)], <span class="dv">0</span>)</span>
<span id="cb186-24"><a href="analysis.html#cb186-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb186-25"><a href="analysis.html#cb186-25" aria-hidden="true" tabindex="-1"></a>  wmy_t_w<span class="sc">$</span>min <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wmy_t_w<span class="sc">$</span>independence <span class="sc">==</span> <span class="st">&quot;h1&quot;</span>, cols_to_compare[<span class="fu">apply</span>(wmy_t_w, <span class="dv">1</span>, which.min)], <span class="dv">0</span>)</span>
<span id="cb186-26"><a href="analysis.html#cb186-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb186-27"><a href="analysis.html#cb186-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#adding Overall value to the table</span></span>
<span id="cb186-28"><a href="analysis.html#cb186-28" aria-hidden="true" tabindex="-1"></a>  ovl_tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">svytable</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;~&quot;</span>,x)), design)))</span>
<span id="cb186-29"><a href="analysis.html#cb186-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(ovl_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;options&quot;</span>, <span class="st">&quot;overall&quot;</span>)</span>
<span id="cb186-30"><a href="analysis.html#cb186-30" aria-hidden="true" tabindex="-1"></a>  wmy_t_w <span class="ot">&lt;-</span> wmy_t_w <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(ovl_tab)</span>
<span id="cb186-31"><a href="analysis.html#cb186-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(wmy_t_w)</span>
<span id="cb186-32"><a href="analysis.html#cb186-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The use with a single-choice question</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="analysis.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi2_ind_extr</span>(<span class="st">&quot;f11_dinking_water_source&quot;</span>, <span class="st">&quot;strata&quot;</span>, svy_design)</span></code></pre></div>
<pre><code>## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion</code></pre>
<pre><code>##                                                                                 variable
## 1                      f11_dinking_water_source bottled_water_water_purchased_in_bottles
## 2 f11_dinking_water_source drinking_water_from_water_kiosk_booth_with_water_for_bottling
## 3                                                 f11_dinking_water_source other_specify
## 4                                                 f11_dinking_water_source personal_well
## 5                        f11_dinking_water_source public_well_or_boreholes_shared_access
## 6                   f11_dinking_water_source tap_drinking_water_centralized_water_supply
## 7                                         f11_dinking_water_source technical_piped_water
## 8                        f11_dinking_water_source trucked_in_water_truck_with_a_tank_etc
##              p  chi_adj df independence 20km_rural 20km_urban   5km_rural
## 1 9.386389e-50 244.6205 21           h1 0.02457002 0.07673267 0.034825871
## 2 9.386389e-50 244.6205 21           h1 0.19901720 0.29950495 0.131840796
## 3 9.386389e-50 244.6205 21           h1 0.01228501 0.00000000 0.007462687
## 4 9.386389e-50 244.6205 21           h1 0.32432432 0.09653465 0.482587065
## 5 9.386389e-50 244.6205 21           h1 0.15724816 0.05445545 0.151741294
## 6 9.386389e-50 244.6205 21           h1 0.22358722 0.43316832 0.144278607
## 7 9.386389e-50 244.6205 21           h1 0.00000000 0.00000000 0.000000000
## 8 9.386389e-50 244.6205 21           h1 0.05896806 0.03960396 0.047263682
##     5km_urban       max        min
## 1 0.032178218 5km_rural 20km_urban
## 2 0.274752475 5km_rural 20km_urban
## 3 0.007425743 5km_rural       &lt;NA&gt;
## 4 0.121287129 5km_rural 20km_urban
## 5 0.099009901 5km_rural 20km_urban
## 6 0.383663366 5km_rural 20km_urban
## 7 0.004950495 5km_rural       &lt;NA&gt;
## 8 0.076732673 5km_rural 20km_urban
##                                                         options     overall
## 1                      bottled_water_water_purchased_in_bottles 0.049170548
## 2 drinking_water_from_water_kiosk_booth_with_water_for_bottling 0.263132750
## 3                                                 other_specify 0.005188695
## 4                                                 personal_well 0.167758525
## 5                        public_well_or_boreholes_shared_access 0.093728457
## 6                   tap_drinking_water_centralized_water_supply 0.362248561
## 7                                         technical_piped_water 0.001836837
## 8                        trucked_in_water_truck_with_a_tank_etc 0.056935627</code></pre>
<p>In the given output, <strong>p</strong> indicates chi-squared test p-value, <strong>chi_adj</strong> - value of chi-squared parameter, <strong>df</strong> - degrees of freedom, <strong>independence</strong> - indicates which hypothesis is accepted, h0 or h1. In the current function, H1 is accepted if p &lt; 0.05. In case H0 is rejected and H1 accepted, in <strong>min</strong> and <strong>max</strong> columns minimum and maximum y variable categories are given.</p>
<p>The use with a multiple-choice question.</p>
<p>The test would not work if any of dummies consists from zeros only, it need to be checked in advance, thus, let’s filter such variables out from the vector of variable names</p>
<p>Getting full range of dummies from the question</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="analysis.html#cb190-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(main_dataset)</span>
<span id="cb190-2"><a href="analysis.html#cb190-2" aria-hidden="true" tabindex="-1"></a>f12 <span class="ot">&lt;-</span> names[<span class="fu">grepl</span>(<span class="st">&quot;f12_drinking_water_treat.&quot;</span>, names)]</span></code></pre></div>
<p>Defining a function which would remove zero-sum variables for us</p>
<p>if the absence of empty cells for each strata is needed, per_cell = T</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="analysis.html#cb191-1" aria-hidden="true" tabindex="-1"></a>non_zero_for_test <span class="ot">&lt;-</span> <span class="cf">function</span>(var, strata, dataset, <span class="at">per_cell =</span> F){</span>
<span id="cb191-2"><a href="analysis.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">sapply</span>(dataset[, <span class="fu">names</span>(dataset) <span class="sc">%in%</span> var], sum))</span>
<span id="cb191-3"><a href="analysis.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rownames</span>(sum), sum)</span>
<span id="cb191-4"><a href="analysis.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  filtered <span class="ot">&lt;-</span> sum[sum[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb191-5"><a href="analysis.html#cb191-5" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">sapply</span>(dataset[,<span class="fu">names</span>(dataset) <span class="sc">%in%</span> filtered], table, dataset[, strata]))</span>
<span id="cb191-6"><a href="analysis.html#cb191-6" aria-hidden="true" tabindex="-1"></a>  ntab <span class="ot">&lt;-</span> <span class="fu">names</span>(tab)</span>
<span id="cb191-7"><a href="analysis.html#cb191-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#if the absence of empty cells for each strata is needed, per_cell = T</span></span>
<span id="cb191-8"><a href="analysis.html#cb191-8" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> tab[, <span class="fu">which</span>(<span class="fu">colnames</span>(tab) <span class="sc">%in%</span> ntab)]</span>
<span id="cb191-9"><a href="analysis.html#cb191-9" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">apply</span>(tab, <span class="dv">2</span>, <span class="cf">function</span>(x) x<span class="sc">==</span><span class="dv">0</span>), <span class="dv">2</span>, any)</span>
<span id="cb191-10"><a href="analysis.html#cb191-10" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> zeros[zeros <span class="sc">==</span> F]</span>
<span id="cb191-11"><a href="analysis.html#cb191-11" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(zeros)</span>
<span id="cb191-12"><a href="analysis.html#cb191-12" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rownames</span>(zeros), zeros)</span>
<span id="cb191-13"><a href="analysis.html#cb191-13" aria-hidden="true" tabindex="-1"></a>  zeros_lab <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(zeros[,<span class="dv">1</span>], <span class="at">split =</span> <span class="st">&quot;.Freq&quot;</span>)))</span>
<span id="cb191-14"><a href="analysis.html#cb191-14" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb191-15"><a href="analysis.html#cb191-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(per_cell <span class="sc">==</span> T){</span>
<span id="cb191-16"><a href="analysis.html#cb191-16" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> zeros_lab</span>
<span id="cb191-17"><a href="analysis.html#cb191-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb191-18"><a href="analysis.html#cb191-18" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> ntab</span>
<span id="cb191-19"><a href="analysis.html#cb191-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb191-20"><a href="analysis.html#cb191-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="fu">abs</span>(<span class="fu">length</span>(var) <span class="sc">-</span> <span class="fu">length</span>(result)), <span class="st">&quot; variables were removed because of containing zeros in stratas&quot;</span>))</span>
<span id="cb191-21"><a href="analysis.html#cb191-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-22"><a href="analysis.html#cb191-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb191-23"><a href="analysis.html#cb191-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Using the test with multiple choice question.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="analysis.html#cb192-1" aria-hidden="true" tabindex="-1"></a>nz_f12 <span class="ot">&lt;-</span> <span class="fu">non_zero_for_test</span>(f12, <span class="st">&quot;strata&quot;</span>, main_dataset, <span class="at">per_cell =</span> F)</span></code></pre></div>
<pre><code>## 2 variables were removed because of containing zeros in stratas</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="analysis.html#cb194-1" aria-hidden="true" tabindex="-1"></a>f12_sig <span class="ot">&lt;-</span> <span class="fu">lapply</span>(nz_f12, chi2_ind_extr, <span class="at">y =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">design =</span> svy_design)</span></code></pre></div>
<pre><code>## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion

## Warning in FUN(newX[, i], ...): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="analysis.html#cb196-1" aria-hidden="true" tabindex="-1"></a>f12_sig_df <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(rbind, f12_sig)</span>
<span id="cb196-2"><a href="analysis.html#cb196-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-3"><a href="analysis.html#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="co">#removing 0 (&quot;not selected&quot;) options</span></span>
<span id="cb196-4"><a href="analysis.html#cb196-4" aria-hidden="true" tabindex="-1"></a>f12_sig_df <span class="ot">&lt;-</span> f12_sig_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(options <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb196-5"><a href="analysis.html#cb196-5" aria-hidden="true" tabindex="-1"></a>f12_sig_df</span></code></pre></div>
<pre><code>##                                                                variable
## 1       f12_drinking_water_treat.cleaning_with_chemicals_chlorination 1
## 2                        f12_drinking_water_treat.water_precipitation 1
## 3         f12_drinking_water_treat.filtering_the_water_pitcher_filter 1
## 4 f12_drinking_water_treat.filtering_the_water_reverse_osmosis_filter 1
## 5                                    f12_drinking_water_treat.boiling 1
## 6                                f12_drinking_water_treat.percolation 1
## 7                              f12_drinking_water_treat.other_specify 1
## 8                      f12_drinking_water_treat.do_not_process_purify 1
##            p  chi_adj df independence  20km_rural  20km_urban   5km_rural
## 1 0.03100696 4.780006  3           h1 0.000000000 0.004950495 0.000000000
## 2 0.02775288 7.977278  3           h1 0.073710074 0.126237624 0.104477612
## 3 0.55635016 1.828231  3           h0 0.046683047 0.069306931 0.059701493
## 4 0.44029529 2.347539  3           h0 0.027027027 0.037128713 0.017412935
## 5 0.02724163 8.191084  3           h1 0.260442260 0.274752475 0.223880597
## 6 0.24801653 3.459406  3           h0 0.004914005 0.002475248 0.007462687
## 7 0.28029092 2.860754  3           h0 0.004914005 0.002475248 0.000000000
## 8 0.01762880 9.011919  3           h1 0.624078624 0.551980198 0.674129353
##    5km_urban       max        min options     overall
## 1 0.00000000 5km_rural       &lt;NA&gt;       1 0.002000313
## 2 0.14108911 5km_rural 20km_urban       1 0.122036605
## 3 0.06930693         0          0       1 0.065108190
## 4 0.04207921         0          0       1 0.036036995
## 5 0.20792079 5km_rural 20km_urban       1 0.244239386
## 6 0.00000000         0          0       1 0.002279393
## 7 0.00000000         0          0       1 0.001769625
## 8 0.60643564 5km_rural 20km_urban       1 0.591818943</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>The function without the survey design object</li>
</ol>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="analysis.html#cb198-1" aria-hidden="true" tabindex="-1"></a>chi2_ind_wtd <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, weight, dataset){</span>
<span id="cb198-2"><a href="analysis.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb198-3"><a href="analysis.html#cb198-3" aria-hidden="true" tabindex="-1"></a>  table_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb198-4"><a href="analysis.html#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb198-5"><a href="analysis.html#cb198-5" aria-hidden="true" tabindex="-1"></a>  ni <span class="ot">&lt;-</span> x[i]</span>
<span id="cb198-6"><a href="analysis.html#cb198-6" aria-hidden="true" tabindex="-1"></a>  ti <span class="ot">&lt;-</span> dataset <span class="sc">%&gt;%</span> </span>
<span id="cb198-7"><a href="analysis.html#cb198-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(y))) <span class="sc">%&gt;%</span></span>
<span id="cb198-8"><a href="analysis.html#cb198-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(y), <span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> </span>
<span id="cb198-9"><a href="analysis.html#cb198-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb198-10"><a href="analysis.html#cb198-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weight)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb198-11"><a href="analysis.html#cb198-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">varnam =</span> ni)</span>
<span id="cb198-12"><a href="analysis.html#cb198-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var_ind&quot;</span>, <span class="st">&quot;var_dep_val&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>,  <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;dep_var_nam&quot;</span>)</span>
<span id="cb198-13"><a href="analysis.html#cb198-13" aria-hidden="true" tabindex="-1"></a>  ti <span class="ot">&lt;-</span> ti <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">base =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(n)))</span>
<span id="cb198-14"><a href="analysis.html#cb198-14" aria-hidden="true" tabindex="-1"></a>  chi_test  <span class="ot">&lt;-</span> <span class="fu">wtd.chi.sq</span>(<span class="at">var1 =</span> dataset[, <span class="fu">paste0</span>(y)], <span class="at">var2 =</span> dataset[, <span class="fu">paste0</span>(ni)], <span class="at">weight =</span> dataset[, <span class="fu">paste0</span>(weight)])</span>
<span id="cb198-15"><a href="analysis.html#cb198-15" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>chisq <span class="ot">&lt;-</span> chi_test[<span class="dv">1</span>]</span>
<span id="cb198-16"><a href="analysis.html#cb198-16" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>df <span class="ot">&lt;-</span> chi_test[<span class="dv">2</span>]</span>
<span id="cb198-17"><a href="analysis.html#cb198-17" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>p <span class="ot">&lt;-</span> chi_test[<span class="dv">3</span>]</span>
<span id="cb198-18"><a href="analysis.html#cb198-18" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>hypo <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ti<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">&quot;h1&quot;</span>, <span class="st">&quot;h0&quot;</span>)</span>
<span id="cb198-19"><a href="analysis.html#cb198-19" aria-hidden="true" tabindex="-1"></a>  table_new <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_new, ti)</span>
<span id="cb198-20"><a href="analysis.html#cb198-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb198-21"><a href="analysis.html#cb198-21" aria-hidden="true" tabindex="-1"></a>table_cl_new_1 <span class="ot">&lt;-</span> table_new <span class="sc">%&gt;%</span> </span>
<span id="cb198-22"><a href="analysis.html#cb198-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(var_dep_val != &quot;0&quot;) %&gt;% </span></span>
<span id="cb198-23"><a href="analysis.html#cb198-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var_dep_val))</span>
<span id="cb198-24"><a href="analysis.html#cb198-24" aria-hidden="true" tabindex="-1"></a><span class="co">#mutate(var_id = paste0(dep_var_nam, &quot;.&quot;, var_dep_val))</span></span>
<span id="cb198-25"><a href="analysis.html#cb198-25" aria-hidden="true" tabindex="-1"></a>table_cl_new_1 <span class="ot">&lt;-</span> table_cl_new_1[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb198-26"><a href="analysis.html#cb198-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-27"><a href="analysis.html#cb198-27" aria-hidden="true" tabindex="-1"></a>table_sprd <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">spread</span>(table_cl_new_1, var_ind, prop) <span class="sc">%&gt;%</span></span>
<span id="cb198-28"><a href="analysis.html#cb198-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dep_var_nam)</span>
<span id="cb198-29"><a href="analysis.html#cb198-29" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(table_sprd)</span>
<span id="cb198-30"><a href="analysis.html#cb198-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The use with the single choice question</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="analysis.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi2_ind_wtd</span>(<span class="at">x =</span> <span class="st">&quot;f11_dinking_water_source&quot;</span>, <span class="at">y =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb199-2"><a href="analysis.html#cb199-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">weight =</span> <span class="st">&quot;stratum.weight&quot;</span>, main_dataset)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 8 x 11
##   var_dep_val         dep_var_nam   base chisq    df        p hypo  `20km_rural`
##   &lt;chr&gt;               &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1 bottled_water_wate~ f11_dinking~  1617  245.    21 4.93e-40 h1          0.0246
## 2 drinking_water_fro~ f11_dinking~  1617  245.    21 4.93e-40 h1          0.199 
## 3 other_specify       f11_dinking~  1617  245.    21 4.93e-40 h1          0.0123
## 4 personal_well       f11_dinking~  1617  245.    21 4.93e-40 h1          0.324 
## 5 public_well_or_bor~ f11_dinking~  1617  245.    21 4.93e-40 h1          0.157 
## 6 tap_drinking_water~ f11_dinking~  1617  245.    21 4.93e-40 h1          0.224 
## 7 technical_piped_wa~ f11_dinking~  1617  245.    21 4.93e-40 h1         NA     
## 8 trucked_in_water_t~ f11_dinking~  1617  245.    21 4.93e-40 h1          0.0590
## # ... with 3 more variables: 20km_urban &lt;dbl&gt;, 5km_rural &lt;dbl&gt;, 5km_urban &lt;dbl&gt;</code></pre>
<p>The use with multiple choice questions</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="analysis.html#cb202-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(main_dataset)</span>
<span id="cb202-2"><a href="analysis.html#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="analysis.html#cb202-3" aria-hidden="true" tabindex="-1"></a>f12_names <span class="ot">&lt;-</span> names[<span class="fu">grepl</span>(<span class="st">&quot;f12_drinking_water_treat.&quot;</span>, names)]</span>
<span id="cb202-4"><a href="analysis.html#cb202-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-5"><a href="analysis.html#cb202-5" aria-hidden="true" tabindex="-1"></a>f12_sig2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(f12_names, chi2_ind_wtd, <span class="at">y =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;stratum.weight&quot;</span>, main_dataset)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.
## `summarise()` has grouped output by &#39;strata&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="analysis.html#cb204-1" aria-hidden="true" tabindex="-1"></a>f12_tab_df <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(rbind, f12_sig2)</span>
<span id="cb204-2"><a href="analysis.html#cb204-2" aria-hidden="true" tabindex="-1"></a>f12_tab_df</span></code></pre></div>
<pre><code>## # A tibble: 18 x 11
##    var_dep_val dep_var_nam            base chisq    df      p hypo  `20km_rural`
##          &lt;int&gt; &lt;chr&gt;                 &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1           0 f12_drinking_water_t~  1617  4.78     3 0.189  h0         1      
##  2           1 f12_drinking_water_t~  1617  4.78     3 0.189  h0        NA      
##  3           0 f12_drinking_water_t~  1617  7.98     3 0.0465 h1         0.926  
##  4           1 f12_drinking_water_t~  1617  7.98     3 0.0465 h1         0.0737 
##  5           0 f12_drinking_water_t~  1617  1.83     3 0.609  h0         0.953  
##  6           1 f12_drinking_water_t~  1617  1.83     3 0.609  h0         0.0467 
##  7           0 f12_drinking_water_t~  1617  2.35     3 0.503  h0         0.973  
##  8           1 f12_drinking_water_t~  1617  2.35     3 0.503  h0         0.0270 
##  9           0 f12_drinking_water_t~  1617  8.19     3 0.0422 h1         0.740  
## 10           1 f12_drinking_water_t~  1617  8.19     3 0.0422 h1         0.260  
## 11           0 f12_drinking_water_t~  1617  3.46     3 0.326  h0         0.995  
## 12           1 f12_drinking_water_t~  1617  3.46     3 0.326  h0         0.00491
## 13           0 f12_drinking_water_t~  1617  2.86     3 0.414  h0         0.995  
## 14           1 f12_drinking_water_t~  1617  2.86     3 0.414  h0         0.00491
## 15           0 f12_drinking_water_t~  1617  0        0 1      h0         1      
## 16           0 f12_drinking_water_t~  1617  0        0 1      h0         1      
## 17           0 f12_drinking_water_t~  1617  9.01     3 0.0291 h1         0.376  
## 18           1 f12_drinking_water_t~  1617  9.01     3 0.0291 h1         0.624  
## # ... with 3 more variables: 20km_urban &lt;dbl&gt;, 5km_rural &lt;dbl&gt;, 5km_urban &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="chi-squared-goodness-of-fit-test" class="section level3" number="7.10.4">
<h3><span class="header-section-number">7.10.4</span> Chi-squared Goodness of Fit test</h3>
<p>Goodness of test chi-squared test is used to compare the observed distribution with the hypothetical one,</p>
<p>For instance, we would like to test the hypothesis, that 90% of HHs had soap in their HHs at the moment of the survey.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="analysis.html#cb206-1" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">soap =</span> <span class="fu">case_when</span>(</span>
<span id="cb206-2"><a href="analysis.html#cb206-2" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;dont_know_refuse_to_answer&quot;</span> <span class="sc">~</span> <span class="st">&quot;NA&quot;</span>,</span>
<span id="cb206-3"><a href="analysis.html#cb206-3" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">~</span> <span class="st">&quot;no&quot;</span>,</span>
<span id="cb206-4"><a href="analysis.html#cb206-4" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;yes_soap_is_not_shown&quot;</span> <span class="sc">~</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb206-5"><a href="analysis.html#cb206-5" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;yes_soap_is_shown&quot;</span> <span class="sc">~</span> <span class="st">&quot;yes&quot;</span></span>
<span id="cb206-6"><a href="analysis.html#cb206-6" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb206-7"><a href="analysis.html#cb206-7" aria-hidden="true" tabindex="-1"></a>soap_prob <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(main_dataset<span class="sc">$</span>soap)))</span>
<span id="cb206-8"><a href="analysis.html#cb206-8" aria-hidden="true" tabindex="-1"></a>soap_prob <span class="ot">&lt;-</span> soap_prob[, <span class="dv">2</span>]</span>
<span id="cb206-9"><a href="analysis.html#cb206-9" aria-hidden="true" tabindex="-1"></a><span class="co"># please, note that this is a function call with unweighted data!</span></span>
<span id="cb206-10"><a href="analysis.html#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(soap_prob, <span class="at">p =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.9</span>))</span></code></pre></div>
<pre><code>## Warning in chisq.test(soap_prob, p = c(0, 0.1, 0.9)): Chi-squared approximation
## may be incorrect</code></pre>
<pre><code>## 
##  Chi-squared test for given probabilities
## 
## data:  soap_prob
## X-squared = Inf, df = 2, p-value &lt; 2.2e-16</code></pre>
<p>As p value is lower than the chosen confidence level, hypothesis of equality of the current distribution to hypothetical 90% / 10% of soap-owners can be rejected.</p>
<p>Defining a function for checking the distribution within a particular group, against the “hypothetical” overall sample.</p>
<p>For the overall sample we would need a variable which has the same value across all observations (e.g. informed consent == yes etc.)</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="analysis.html#cb209-1" aria-hidden="true" tabindex="-1"></a>chi2_GoF <span class="ot">&lt;-</span> <span class="cf">function</span>(name, stratum_hyp, stratum_2, value_stratum_hyp, value_stratum_2, data, weights){</span>
<span id="cb209-2"><a href="analysis.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb209-3"><a href="analysis.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  table_1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb209-4"><a href="analysis.html#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name)) {</span>
<span id="cb209-5"><a href="analysis.html#cb209-5" aria-hidden="true" tabindex="-1"></a>    ni <span class="ot">&lt;-</span> name[i]</span>
<span id="cb209-6"><a href="analysis.html#cb209-6" aria-hidden="true" tabindex="-1"></a>    ti <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb209-7"><a href="analysis.html#cb209-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(stratum_hyp) <span class="sc">==</span> <span class="fu">paste0</span>(value_stratum_hyp)) <span class="sc">%&gt;%</span></span>
<span id="cb209-8"><a href="analysis.html#cb209-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb209-9"><a href="analysis.html#cb209-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weights)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb209-10"><a href="analysis.html#cb209-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">base =</span> <span class="fu">sum</span>(wtn), <span class="at">cnt =</span> <span class="fu">sum</span>(n))<span class="sc">%&gt;%</span></span>
<span id="cb209-11"><a href="analysis.html#cb209-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">varnam =</span> ni)</span>
<span id="cb209-12"><a href="analysis.html#cb209-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;base_w&quot;</span>, <span class="st">&quot;count&quot;</span>, <span class="st">&quot;nam&quot;</span>)</span>
<span id="cb209-13"><a href="analysis.html#cb209-13" aria-hidden="true" tabindex="-1"></a>    table_1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_1, ti)</span>
<span id="cb209-14"><a href="analysis.html#cb209-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb209-15"><a href="analysis.html#cb209-15" aria-hidden="true" tabindex="-1"></a>  table_cl_1 <span class="ot">&lt;-</span> table_1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb209-16"><a href="analysis.html#cb209-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var_id =</span> <span class="fu">paste0</span>(nam, <span class="st">&quot;.&quot;</span>, var))</span>
<span id="cb209-17"><a href="analysis.html#cb209-17" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb209-18"><a href="analysis.html#cb209-18" aria-hidden="true" tabindex="-1"></a>  table_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb209-19"><a href="analysis.html#cb209-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name)) {</span>
<span id="cb209-20"><a href="analysis.html#cb209-20" aria-hidden="true" tabindex="-1"></a>    ni <span class="ot">&lt;-</span> name[i]</span>
<span id="cb209-21"><a href="analysis.html#cb209-21" aria-hidden="true" tabindex="-1"></a>    ti <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb209-22"><a href="analysis.html#cb209-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(stratum_2) <span class="sc">==</span> <span class="fu">paste0</span>(value_stratum_2)) <span class="sc">%&gt;%</span></span>
<span id="cb209-23"><a href="analysis.html#cb209-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb209-24"><a href="analysis.html#cb209-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weights)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb209-25"><a href="analysis.html#cb209-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">base =</span> <span class="fu">sum</span>(wtn), <span class="at">cnt =</span> <span class="fu">sum</span>(n))<span class="sc">%&gt;%</span></span>
<span id="cb209-26"><a href="analysis.html#cb209-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">varnam =</span> ni)</span>
<span id="cb209-27"><a href="analysis.html#cb209-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;base_w&quot;</span>, <span class="st">&quot;count&quot;</span>, <span class="st">&quot;nam&quot;</span>)</span>
<span id="cb209-28"><a href="analysis.html#cb209-28" aria-hidden="true" tabindex="-1"></a>    table_2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_2, ti)</span>
<span id="cb209-29"><a href="analysis.html#cb209-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb209-30"><a href="analysis.html#cb209-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-31"><a href="analysis.html#cb209-31" aria-hidden="true" tabindex="-1"></a>  table_cl_2 <span class="ot">&lt;-</span> table_2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb209-32"><a href="analysis.html#cb209-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var_id =</span> <span class="fu">paste0</span>(nam, <span class="st">&quot;.&quot;</span>, var))</span>
<span id="cb209-33"><a href="analysis.html#cb209-33" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> <span class="fu">merge</span>(table_cl_1, table_cl_2, <span class="at">by =</span> <span class="st">&quot;var_id&quot;</span>, <span class="at">all =</span> T)</span>
<span id="cb209-34"><a href="analysis.html#cb209-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(table_cl_compare) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var.id&quot;</span>, <span class="st">&quot;var.hyp&quot;</span>, <span class="st">&quot;wtn.hyp&quot;</span>, <span class="st">&quot;n.hyp&quot;</span>, <span class="st">&quot;prop.hyp&quot;</span>, <span class="st">&quot;base.hyp&quot;</span>, <span class="st">&quot;base_nw.hyp&quot;</span>,<span class="st">&quot;nam.hyp&quot;</span>, <span class="st">&quot;var.2&quot;</span>, <span class="st">&quot;wtn.2&quot;</span>, <span class="st">&quot;n.2&quot;</span>, <span class="st">&quot;prop.2&quot;</span>, <span class="st">&quot;base.2&quot;</span>, <span class="st">&quot;base_nw.2&quot;</span>, <span class="st">&quot;nam.2&quot;</span>)</span>
<span id="cb209-35"><a href="analysis.html#cb209-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-36"><a href="analysis.html#cb209-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Dealing with NA issues</span></span>
<span id="cb209-37"><a href="analysis.html#cb209-37" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>nam.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.hyp)] <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.hyp)]</span>
<span id="cb209-38"><a href="analysis.html#cb209-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-39"><a href="analysis.html#cb209-39" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>)] <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>)]</span>
<span id="cb209-40"><a href="analysis.html#cb209-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-41"><a href="analysis.html#cb209-41" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>to_split <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam.hyp</span>
<span id="cb209-42"><a href="analysis.html#cb209-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-43"><a href="analysis.html#cb209-43" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> <span class="fu">separate</span>(table_cl_compare, <span class="at">col =</span> to_split, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;indctr&quot;</span>, <span class="st">&quot;item&quot;</span>), <span class="at">sep =</span><span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>)</span>
<span id="cb209-44"><a href="analysis.html#cb209-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-45"><a href="analysis.html#cb209-45" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.hyp, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.hyp, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb209-46"><a href="analysis.html#cb209-46" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.hyp, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.hyp, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb209-47"><a href="analysis.html#cb209-47" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw<span class="fl">.2</span>, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw<span class="fl">.2</span>, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb209-48"><a href="analysis.html#cb209-48" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base<span class="fl">.2</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.hyp, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base<span class="fl">.2</span>, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb209-49"><a href="analysis.html#cb209-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-50"><a href="analysis.html#cb209-50" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>prop.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>prop.hyp)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb209-51"><a href="analysis.html#cb209-51" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>prop<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>prop<span class="fl">.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb209-52"><a href="analysis.html#cb209-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-53"><a href="analysis.html#cb209-53" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>wtn.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>wtn.hyp)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb209-54"><a href="analysis.html#cb209-54" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb209-55"><a href="analysis.html#cb209-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-56"><a href="analysis.html#cb209-56" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>chi2 <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>, <span class="at">p =</span> table_cl_compare<span class="sc">$</span>prop.hyp)<span class="sc">$</span>statistic</span>
<span id="cb209-57"><a href="analysis.html#cb209-57" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>, <span class="at">p =</span> table_cl_compare<span class="sc">$</span>prop.hyp)<span class="sc">$</span>p.value</span>
<span id="cb209-58"><a href="analysis.html#cb209-58" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>df <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>, <span class="at">p =</span> table_cl_compare<span class="sc">$</span>prop.hyp)<span class="sc">$</span>df</span>
<span id="cb209-59"><a href="analysis.html#cb209-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-60"><a href="analysis.html#cb209-60" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>H0 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(table_cl_compare<span class="sc">$</span>p <span class="sc">&lt;=</span> <span class="fl">0.05</span>, <span class="st">&quot;H1 - different&quot;</span>, <span class="st">&quot;H0 - same&quot;</span>)</span>
<span id="cb209-61"><a href="analysis.html#cb209-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(table_cl_compare)</span>
<span id="cb209-62"><a href="analysis.html#cb209-62" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Using the function with a single choice question</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="analysis.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi2_GoF</span>(<span class="at">name =</span> <span class="st">&quot;f11_dinking_water_source&quot;</span>, <span class="at">stratum_hyp =</span> <span class="st">&quot;a1_informed_consent&quot;</span>, <span class="at">stratum_2 =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">value_stratum_hyp =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">value_stratum_2 =</span> <span class="st">&quot;5km_rural&quot;</span>, <span class="at">data =</span> main_dataset, <span class="at">weights =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 8 rows [1, 2, 3,
## 4, 5, 6, 7, 8].</code></pre>
<pre><code>## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect</code></pre>
<pre><code>## # A tibble: 8 x 20
##   var.id    var.hyp   wtn.hyp n.hyp prop.hyp base.hyp base_nw.hyp nam.hyp var.2 
##   &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 f11_dink~ bottled_~   79.5     68  0.0492     1617.        1617 f11_di~ bottl~
## 2 f11_dink~ drinking~  425.     366  0.263      1617.        1617 f11_di~ drink~
## 3 f11_dink~ other_sp~    8.39    11  0.00519    1617.        1617 f11_di~ other~
## 4 f11_dink~ personal~  271.     414  0.168      1617.        1617 f11_di~ perso~
## 5 f11_dink~ public_w~  152.     187  0.0937     1617.        1617 f11_di~ publi~
## 6 f11_dink~ tap_drin~  586.     479  0.362      1617.        1617 f11_di~ tap_d~
## 7 f11_dink~ technica~    2.97     2  0.00184    1617.        1617 f11_di~ &lt;NA&gt;  
## 8 f11_dink~ trucked_~   92.1     90  0.0569     1617.        1617 f11_di~ truck~
## # ... with 11 more variables: wtn.2 &lt;dbl&gt;, n.2 &lt;int&gt;, prop.2 &lt;dbl&gt;,
## #   base.2 &lt;dbl&gt;, base_nw.2 &lt;int&gt;, nam.2 &lt;chr&gt;, indctr &lt;chr&gt;, item &lt;chr&gt;,
## #   chi2 &lt;dbl&gt;, p &lt;dbl&gt;, H0 &lt;chr&gt;</code></pre>
<p>Using the function with the multiple responce set</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="analysis.html#cb214-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(main_dataset)</span>
<span id="cb214-2"><a href="analysis.html#cb214-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-3"><a href="analysis.html#cb214-3" aria-hidden="true" tabindex="-1"></a>f12_names <span class="ot">&lt;-</span> names[<span class="fu">grepl</span>(<span class="st">&quot;f12_drinking_water_treat.&quot;</span>, names)]</span>
<span id="cb214-4"><a href="analysis.html#cb214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-5"><a href="analysis.html#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="co">#removing empty variables from the MR set</span></span>
<span id="cb214-6"><a href="analysis.html#cb214-6" aria-hidden="true" tabindex="-1"></a>nz_f12 <span class="ot">&lt;-</span> <span class="fu">non_zero_for_test</span>(f12_names, <span class="st">&quot;strata&quot;</span>, main_dataset, <span class="at">per_cell =</span> F)</span></code></pre></div>
<pre><code>## 2 variables were removed because of containing zeros in stratas</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="analysis.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(main_dataset[, nz_f12[<span class="dv">4</span>]], main_dataset[, <span class="st">&quot;strata&quot;</span>])</span></code></pre></div>
<pre><code>##    
##     20km_rural 20km_urban 5km_rural 5km_urban
##   0        396        389       395       387
##   1         11         15         7        17</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="analysis.html#cb218-1" aria-hidden="true" tabindex="-1"></a>f12_sig2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(nz_f12, chi2_GoF, <span class="at">stratum_hyp =</span> <span class="st">&quot;a1_informed_consent&quot;</span>, <span class="at">stratum_2 =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">value_stratum_hyp =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">value_stratum_2 =</span> <span class="st">&quot;5km_rural&quot;</span>, <span class="at">data =</span> main_dataset, <span class="at">weights =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="analysis.html#cb220-1" aria-hidden="true" tabindex="-1"></a>f12_sig2_df <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(rbind, f12_sig2)</span>
<span id="cb220-2"><a href="analysis.html#cb220-2" aria-hidden="true" tabindex="-1"></a>f12_sig2_df</span></code></pre></div>
<pre><code>## # A tibble: 16 x 20
##    var.id    var.hyp wtn.hyp n.hyp prop.hyp base.hyp base_nw.hyp nam.hyp   var.2
##    &lt;chr&gt;       &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
##  1 f12_drin~       0 1614.    1615  0.998      1617.        1617 f12_drin~     0
##  2 f12_drin~       1    3.23     2  0.00200    1617.        1617 f12_drin~    NA
##  3 f12_drin~       0 1420.    1437  0.878      1617.        1617 f12_drin~     0
##  4 f12_drin~       1  197.     180  0.122      1617.        1617 f12_drin~     1
##  5 f12_drin~       0 1512.    1518  0.935      1617.        1617 f12_drin~     0
##  6 f12_drin~       1  105.      99  0.0651     1617.        1617 f12_drin~     1
##  7 f12_drin~       0 1559.    1567  0.964      1617.        1617 f12_drin~     0
##  8 f12_drin~       1   58.3     50  0.0360     1617.        1617 f12_drin~     1
##  9 f12_drin~       0 1222.    1226  0.756      1617.        1617 f12_drin~     0
## 10 f12_drin~       1  395.     391  0.244      1617.        1617 f12_drin~     1
## 11 f12_drin~       0 1613.    1611  0.998      1617.        1617 f12_drin~     0
## 12 f12_drin~       1    3.69     6  0.00228    1617.        1617 f12_drin~     1
## 13 f12_drin~       0 1614.    1614  0.998      1617.        1617 f12_drin~     0
## 14 f12_drin~       1    2.86     3  0.00177    1617.        1617 f12_drin~    NA
## 15 f12_drin~       0  660.     624  0.408      1617.        1617 f12_drin~     0
## 16 f12_drin~       1  957.     993  0.592      1617.        1617 f12_drin~     1
## # ... with 11 more variables: wtn.2 &lt;dbl&gt;, n.2 &lt;int&gt;, prop.2 &lt;dbl&gt;,
## #   base.2 &lt;dbl&gt;, base_nw.2 &lt;int&gt;, nam.2 &lt;chr&gt;, indctr &lt;chr&gt;, item &lt;chr&gt;,
## #   chi2 &lt;dbl&gt;, p &lt;dbl&gt;, H0 &lt;chr&gt;</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="composite-indicators.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="outputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
