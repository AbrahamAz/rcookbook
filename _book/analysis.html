<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Analysis | R cookbook for analysis with REACH</title>
  <meta name="description" content="5 Analysis | R cookbook for analysis with REACH" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Analysis | R cookbook for analysis with REACH" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Analysis | R cookbook for analysis with REACH" />
  
  
  

<meta name="author" content="R CoP" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="composite-indicators.html"/>
<link rel="next" href="outputs.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hello World</a></li>
<li class="chapter" data-level="2" data-path="meta-information.html"><a href="meta-information.html"><i class="fa fa-check"></i><b>2</b> Meta information</a><ul>
<li class="chapter" data-level="2.1" data-path="meta-information.html"><a href="meta-information.html#creating-the-questionnaire-object"><i class="fa fa-check"></i><b>2.1</b> Creating the questionnaire object</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>3</b> Cleaning</a><ul>
<li class="chapter" data-level="3.1" data-path="cleaning.html"><a href="cleaning.html#custom-packages-with-cleaning-functions"><i class="fa fa-check"></i><b>3.1</b> Custom packages with cleaning functions</a></li>
<li class="chapter" data-level="3.2" data-path="cleaning.html"><a href="cleaning.html#example-one"><i class="fa fa-check"></i><b>3.2</b> Example one</a></li>
<li class="chapter" data-level="3.3" data-path="cleaning.html"><a href="cleaning.html#example-two"><i class="fa fa-check"></i><b>3.3</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="composite-indicators.html"><a href="composite-indicators.html"><i class="fa fa-check"></i><b>4</b> Composite indicators</a><ul>
<li class="chapter" data-level="4.1" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-one"><i class="fa fa-check"></i><b>4.1</b> Composite with 1 categorical variable - select one</a></li>
<li class="chapter" data-level="4.2" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-categorical-variables"><i class="fa fa-check"></i><b>4.2</b> Composite with 2 categorical variables</a></li>
<li class="chapter" data-level="4.3" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-multiple"><i class="fa fa-check"></i><b>4.3</b> Composite with 1 categorical variable - select multiple</a></li>
<li class="chapter" data-level="4.4" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-numerical-variable"><i class="fa fa-check"></i><b>4.4</b> Composite with 1 numerical variable</a></li>
<li class="chapter" data-level="4.5" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-numerical-variables"><i class="fa fa-check"></i><b>4.5</b> Composite with 2 numerical variables</a></li>
<li class="chapter" data-level="4.6" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-or-more-numerical-variables"><i class="fa fa-check"></i><b>4.6</b> Composite with 2 or more numerical variables</a></li>
<li class="chapter" data-level="4.7" data-path="composite-indicators.html"><a href="composite-indicators.html#new-indicators-from-a-loop-to-main-dataset"><i class="fa fa-check"></i><b>4.7</b> New indicators from a loop to main dataset</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>5</b> Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="analysis.html"><a href="analysis.html#hypegrammar"><i class="fa fa-check"></i><b>5.1</b> hypegrammaR</a></li>
<li class="chapter" data-level="5.2" data-path="analysis.html"><a href="analysis.html#srvyr-package"><i class="fa fa-check"></i><b>5.2</b> srvyr package</a><ul>
<li class="chapter" data-level="5.2.1" data-path="analysis.html"><a href="analysis.html#categorical-variables"><i class="fa fa-check"></i><b>5.2.1</b> Categorical variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="analysis.html"><a href="analysis.html#numeric-variables"><i class="fa fa-check"></i><b>5.2.2</b> Numeric variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="analysis.html"><a href="analysis.html#butter-survey_collapse"><i class="fa fa-check"></i><b>5.3</b> butteR survey_collapse</a><ul>
<li class="chapter" data-level="5.3.1" data-path="analysis.html"><a href="analysis.html#select_one"><i class="fa fa-check"></i><b>5.3.1</b> select_one</a></li>
<li class="chapter" data-level="5.3.2" data-path="analysis.html"><a href="analysis.html#select_mutiple"><i class="fa fa-check"></i><b>5.3.2</b> select_mutiple</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="analysis.html"><a href="analysis.html#analysis-with-numerical-variables"><i class="fa fa-check"></i><b>5.4</b> Analysis with numerical variables</a></li>
<li class="chapter" data-level="5.5" data-path="analysis.html"><a href="analysis.html#weights"><i class="fa fa-check"></i><b>5.5</b> Weights</a></li>
<li class="chapter" data-level="5.6" data-path="analysis.html"><a href="analysis.html#repeating-the-above"><i class="fa fa-check"></i><b>5.6</b> Repeating the above</a></li>
<li class="chapter" data-level="5.7" data-path="analysis.html"><a href="analysis.html#top-3"><i class="fa fa-check"></i><b>5.7</b> Top 3</a></li>
<li class="chapter" data-level="5.8" data-path="analysis.html"><a href="analysis.html#borda-count"><i class="fa fa-check"></i><b>5.8</b> Borda count</a></li>
<li class="chapter" data-level="5.9" data-path="analysis.html"><a href="analysis.html#hypothesis-testing"><i class="fa fa-check"></i><b>5.9</b> Hypothesis testing</a><ul>
<li class="chapter" data-level="5.9.1" data-path="analysis.html"><a href="analysis.html#t-test"><i class="fa fa-check"></i><b>5.9.1</b> T-test</a></li>
<li class="chapter" data-level="5.9.2" data-path="analysis.html"><a href="analysis.html#anova"><i class="fa fa-check"></i><b>5.9.2</b> ANOVA</a></li>
<li class="chapter" data-level="5.9.3" data-path="analysis.html"><a href="analysis.html#chi-squares"><i class="fa fa-check"></i><b>5.9.3</b> chi-squares</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>6</b> Outputs</a><ul>
<li class="chapter" data-level="6.1" data-path="outputs.html"><a href="outputs.html#from-long-to-large-table"><i class="fa fa-check"></i><b>6.1</b> From long to large table</a></li>
<li class="chapter" data-level="6.2" data-path="outputs.html"><a href="outputs.html#merge-file"><i class="fa fa-check"></i><b>6.2</b> Merge file</a></li>
<li class="chapter" data-level="6.3" data-path="outputs.html"><a href="outputs.html#graphs"><i class="fa fa-check"></i><b>6.3</b> Graphs</a><ul>
<li class="chapter" data-level="6.3.1" data-path="outputs.html"><a href="outputs.html#spider-graphs"><i class="fa fa-check"></i><b>6.3.1</b> spider graphs</a></li>
<li class="chapter" data-level="6.3.2" data-path="outputs.html"><a href="outputs.html#prison-graphs"><i class="fa fa-check"></i><b>6.3.2</b> prison graphs</a></li>
<li class="chapter" data-level="6.3.3" data-path="outputs.html"><a href="outputs.html#venn-diagram"><i class="fa fa-check"></i><b>6.3.3</b> venn diagram</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="outputs.html"><a href="outputs.html#labels"><i class="fa fa-check"></i><b>6.4</b> Labels</a><ul>
<li class="chapter" data-level="6.4.1" data-path="outputs.html"><a href="outputs.html#change-from-xml-to-label"><i class="fa fa-check"></i><b>6.4.1</b> change from xml to label</a></li>
<li class="chapter" data-level="6.4.2" data-path="outputs.html"><a href="outputs.html#change-from-label-to-xml"><i class="fa fa-check"></i><b>6.4.2</b> change from label to xml</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="outputs.html"><a href="outputs.html#dashboarding---sharing-information"><i class="fa fa-check"></i><b>6.5</b> Dashboarding - Sharing information</a></li>
<li class="chapter" data-level="6.6" data-path="outputs.html"><a href="outputs.html#outputs-with-hypothesis-testing-results"><i class="fa fa-check"></i><b>6.6</b> Outputs with hypothesis testing results</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>7</b> Miscellaneous</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R cookbook for analysis with REACH</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis" class="section level1">
<h1><span class="header-section-number">5</span> Analysis</h1>
<div id="hypegrammar" class="section level2">
<h2><span class="header-section-number">5.1</span> hypegrammaR</h2>
<p>hypegrammaR follow the case mapping logic to compute analysis. It will also use the kobo questionnaire tool to help some of decision to be made.</p>
<p>This just load the information that will be need to conduct the analysis :</p>
<ul>
<li>dataset,</li>
<li>kobotool (questions and choices),</li>
<li>sample frame</li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="analysis.html#cb55-1"></a><span class="kw">library</span>(hypegrammaR)</span>
<span id="cb55-2"><a href="analysis.html#cb55-2"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb55-3"><a href="analysis.html#cb55-3"></a><span class="kw">library</span>(surveyweights)</span>
<span id="cb55-4"><a href="analysis.html#cb55-4"></a><span class="kw">library</span>(srvyr)</span>
<span id="cb55-5"><a href="analysis.html#cb55-5"></a><span class="kw">library</span>(readxl)</span>
<span id="cb55-6"><a href="analysis.html#cb55-6"></a></span>
<span id="cb55-7"><a href="analysis.html#cb55-7"></a><span class="co">#load dataset</span></span>
<span id="cb55-8"><a href="analysis.html#cb55-8"></a>main_dataset &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="dt">na.strings =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb55-9"><a href="analysis.html#cb55-9"></a></span>
<span id="cb55-10"><a href="analysis.html#cb55-10"></a><span class="co">#load kobotool</span></span>
<span id="cb55-11"><a href="analysis.html#cb55-11"></a>questions &lt;-<span class="st"> </span><span class="kw">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="dt">sheet=</span><span class="st">&quot;survey&quot;</span>)</span>
<span id="cb55-12"><a href="analysis.html#cb55-12"></a>choices &lt;-<span class="st"> </span><span class="kw">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="dt">sheet=</span><span class="st">&quot;choices&quot;</span>)</span>
<span id="cb55-13"><a href="analysis.html#cb55-13"></a></span>
<span id="cb55-14"><a href="analysis.html#cb55-14"></a><span class="co">#load sampling frame</span></span>
<span id="cb55-15"><a href="analysis.html#cb55-15"></a>my_sampling_frame &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_GCA_Weights_26AUG2020.xlsx&quot;</span>, </span>
<span id="cb55-16"><a href="analysis.html#cb55-16"></a>                             <span class="dt">sheet =</span> <span class="st">&quot;for_r&quot;</span>)</span></code></pre></div>
<p>The questionnaire object is a list of function using the kobotool and dataset as input. For example, it will check if a given variable is a select multiple or not.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="analysis.html#cb56-1"></a><span class="co">#create a questionnaire object</span></span>
<span id="cb56-2"><a href="analysis.html#cb56-2"></a>my_questionnaire &lt;-<span class="st"> </span>hypegrammaR<span class="op">::</span><span class="kw">load_questionnaire</span>(<span class="dt">data =</span> main_dataset,</span>
<span id="cb56-3"><a href="analysis.html#cb56-3"></a>                                    <span class="dt">questions =</span> questions,</span>
<span id="cb56-4"><a href="analysis.html#cb56-4"></a>                                    <span class="dt">choices =</span> choices,</span>
<span id="cb56-5"><a href="analysis.html#cb56-5"></a>                                    <span class="dt">choices.label.column.to.use =</span> <span class="st">&quot;label::English&quot;</span>)</span></code></pre></div>
<p>The weighting function is created by the weighting_fun_from_samplinframe from the surveyweights package. It calculates the design weight based on the sampling frame and the dataset. The stratification names values used in the sampling frame and the dataset <strong>HAS</strong> to be the same.
What it does, it create a function that will calculate the weights based on your dataset.
<em>(It was defined as a function so it could re-calculate weights depending on the subset. however, the current guidelines is to keep the same design weights through all the assessement; the function still works for that case)</em></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="analysis.html#cb57-1"></a><span class="co">#create a weigthing function</span></span>
<span id="cb57-2"><a href="analysis.html#cb57-2"></a>my_weigthing_function &lt;-<span class="st"> </span>surveyweights<span class="op">::</span><span class="kw">weighting_fun_from_samplingframe</span>(<span class="dt">sampling.frame =</span> my_sampling_frame,</span>
<span id="cb57-3"><a href="analysis.html#cb57-3"></a>                                                                      <span class="dt">data.stratum.column =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb57-4"><a href="analysis.html#cb57-4"></a>                                                                      <span class="dt">sampling.frame.population.column =</span> <span class="st">&quot;population&quot;</span>, </span>
<span id="cb57-5"><a href="analysis.html#cb57-5"></a>                                                                      <span class="dt">sampling.frame.stratum.column =</span> <span class="st">&quot;strata&quot;</span>, </span>
<span id="cb57-6"><a href="analysis.html#cb57-6"></a>                                                                      <span class="dt">data =</span> main_dataset)</span></code></pre></div>
<p>If you want to add the weights to your dataframe this is how you can do it.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="analysis.html#cb58-1"></a><span class="co">#optional, if you want to add the weights into the dataset.</span></span>
<span id="cb58-2"><a href="analysis.html#cb58-2"></a>main_dataset<span class="op">$</span>stratum.weight &lt;-<span class="st"> </span><span class="kw">my_weigthing_function</span>(main_dataset)</span></code></pre></div>
<p>hypegrammaR uses cases to choose what type analysis to do. A “case” for hypegrammaR is a character string CASE_XXXX_YYYY_ZZZZ where :</p>
<ul>
<li>XXXX: hypothesis type (group_difference, direct_reporting)<br />
</li>
<li>YYYY: dependent var type (categorical, numerical)<br />
</li>
<li>ZZZZ: independent var type (categorical, numerical, <em>empty</em> if no independent variable) .</li>
</ul>
<p>All cases implemented can been seen with this code.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="analysis.html#cb59-1"></a>hypegrammaR<span class="op">:::</span><span class="kw">list_all_cases</span>(<span class="dt">implemented_only =</span> T)</span></code></pre></div>
<pre><code>##  [1] &quot;CASE_group_difference_categorical_categorical&quot;
##  [2] &quot;CASE_group_difference_numerical_categorical&quot;  
##  [3] &quot;CASE_direct_reporting_numerical_&quot;             
##  [4] &quot;CASE_direct_reporting_categorical_&quot;           
##  [5] &quot;CASE_direct_reporting_categorical_categorical&quot;
##  [6] &quot;CASE_direct_reporting_numerical_categorical&quot;  
##  [7] &quot;CASE_limit_categorical&quot;                       
##  [8] &quot;CASE_limit_numerical&quot;                         
##  [9] &quot;CASE_correlation_numerical_numerical&quot;         
## [10] &quot;CASE_correlation_categorical_numerical&quot;</code></pre>
<p>If you want to know what are the different proportion of the displacement status for each strata. The following information I need are:
hypothesis : group_difference<br />
dependent variable : d1_hh_displacement_status -&gt; categorical<br />
independent_variable : strata -&gt; categorical</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="analysis.html#cb61-1"></a><span class="co">#analysis </span></span>
<span id="cb61-2"><a href="analysis.html#cb61-2"></a>my_case &lt;-<span class="st"> </span>hypegrammaR<span class="op">::</span><span class="kw">map_to_case</span>(<span class="dt">hypothesis.type =</span> <span class="st">&quot;group_difference&quot;</span>,</span>
<span id="cb61-3"><a href="analysis.html#cb61-3"></a>                       <span class="dt">dependent.var.type =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb61-4"><a href="analysis.html#cb61-4"></a>                       <span class="dt">independent.var.type =</span> <span class="st">&quot;categorical&quot;</span>)</span>
<span id="cb61-5"><a href="analysis.html#cb61-5"></a></span>
<span id="cb61-6"><a href="analysis.html#cb61-6"></a>my_case</span></code></pre></div>
<pre><code>## [1] &quot;CASE_group_difference_categorical_categorical&quot;
## attr(,&quot;class&quot;)
## [1] &quot;analysis_case&quot;</code></pre>
<p>The function map_to_result will calculate your summary statistics, it will take a couple of arguments.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="analysis.html#cb63-1"></a>my_results &lt;-<span class="st"> </span>hypegrammaR<span class="op">::</span><span class="kw">map_to_result</span>(<span class="dt">data =</span> main_dataset, </span>
<span id="cb63-2"><a href="analysis.html#cb63-2"></a>                            <span class="dt">dependent.var =</span> <span class="st">&quot;d1_hh_displacement_status&quot;</span>, </span>
<span id="cb63-3"><a href="analysis.html#cb63-3"></a>                            <span class="dt">independent.var =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb63-4"><a href="analysis.html#cb63-4"></a>                            <span class="dt">case =</span> my_case, </span>
<span id="cb63-5"><a href="analysis.html#cb63-5"></a>                            <span class="dt">weighting =</span> my_weigthing_function,</span>
<span id="cb63-6"><a href="analysis.html#cb63-6"></a>                            <span class="dt">questionnaire =</span> my_questionnaire,</span>
<span id="cb63-7"><a href="analysis.html#cb63-7"></a>                            <span class="dt">confidence_level =</span> <span class="fl">.90</span>)</span></code></pre></div>
<p>The result object is a list with several information:</p>
<ul>
<li>parameters: returns the information used of that analysis</li>
<li>summary statistics: returns the summary statistics in a tidy format</li>
<li>hypothesis test: returns hypothesis testing information (if avalaible)</li>
<li>message: returns a message (if the analysis went well or not)</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="analysis.html#cb64-1"></a>my_results<span class="op">$</span>summary.statistic <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##               dependent.var independent.var
## 1 d1_hh_displacement_status          strata
## 2 d1_hh_displacement_status          strata
## 3 d1_hh_displacement_status          strata
## 4 d1_hh_displacement_status          strata
## 5 d1_hh_displacement_status          strata
## 6 d1_hh_displacement_status          strata
##                                          dependent.var.value
## 1                                   displaced_and_idp_status
## 2                     displaced_but_does_not_have_idp_status
## 3                                                         no
## 4               partially_displaced_and_dont_have_idp_status
## 5                    partially_displaced_and_have_idp_status
## 6 used_to_be_displaced_but_returned_and_has_no_status_of_idp
##   independent.var.value     numbers se           min         max
## 1            20km_rural 0.046683047 NA  0.0261473551 0.067218738
## 2            20km_rural 0.002457002 NA -0.0023622501 0.007276255
## 3            20km_rural 0.911547912 NA  0.8839068400 0.939188983
## 4            20km_rural 0.007371007 NA -0.0009555979 0.015697613
## 5            20km_rural 0.022113022 NA  0.0077984141 0.036427630
## 6            20km_rural 0.009828010 NA  0.0002251810 0.019430839</code></pre>
<p>If you need to run several analysis, you can use a data analysis plan (DAP) file which is a file that comprises of the following columns:</p>
<ul>
<li>dependent.variable: name of the dependent variable (kobo name, column name)<br />
</li>
<li>dependent.variable.type: type of the dependent variable (categorical or numerical or empty)<br />
</li>
<li>independent.variable: name of the independent variable (kobo name, column name)<br />
</li>
<li>independent.variable.type: type of the independent variable (categorical or numerical or empty)<br />
</li>
<li>repeat.for.variable: name of the variable to repeat the analysis for (e.g per camp or district or governorate)<br />
</li>
<li>hypothesis.type: type of hypothesis (group_difference, direct_reporting)</li>
<li>you can have other columns to help you write the analysis plan such as RQ and sub RQ</li>
</ul>
<p><strong>You cannot have duplicate columns</strong></p>
<p>Below, I am creating the DAP, but you could read a csv file. It has :</p>
<ul>
<li>2 categorical variables, (select multiple type in kobo), <em>l4_which_difficult_access_health</em> and <em>j10_education_security_concerns_in_the_vicinity_of_facility</em></li>
<li>2 categorical variables, (select one type in kobo), <em>b9_hohh_marital_status</em> and <em>d1_hh_displacement_status</em>,</li>
<li>2 numerical variables (integer type in kobo): <em>b7_hohh_age</em> and <em>b5_age</em></li>
</ul>
<p>It will repeat the analysis 3 times for each dependent variable:</p>
<ul>
<li>using the <em>strata</em> variable as independent variable (first 6 rows),</li>
<li>using no independent variable, for the complete dataset (national level?), (second 6 rows),</li>
<li>using the <em>b9_hohh_marital_status</em> as independent variable but repeating each strata (last 6 rows)</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="analysis.html#cb66-1"></a><span class="co">#dap </span></span>
<span id="cb66-2"><a href="analysis.html#cb66-2"></a>my_dap &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dependent.variable =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>, <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>, <span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb66-3"><a href="analysis.html#cb66-3"></a>                 <span class="st">&quot;b5_age&quot;</span>, <span class="st">&quot;b9_hohh_marital_status&quot;</span>,</span>
<span id="cb66-4"><a href="analysis.html#cb66-4"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>), <span class="dv">2</span>), <span class="kw">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>, <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>, <span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb66-5"><a href="analysis.html#cb66-5"></a>                 <span class="st">&quot;b5_age&quot;</span>,</span>
<span id="cb66-6"><a href="analysis.html#cb66-6"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>)),</span>
<span id="cb66-7"><a href="analysis.html#cb66-7"></a>                     <span class="dt">dependent.variable.type =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>),<span class="dv">2</span>),<span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;categorical&quot;</span>),</span>
<span id="cb66-8"><a href="analysis.html#cb66-8"></a>                     <span class="dt">independent.variable =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;strata&quot;</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="ot">NA</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="st">&quot;b9_hohh_marital_status&quot;</span>, <span class="dv">5</span>)),</span>
<span id="cb66-9"><a href="analysis.html#cb66-9"></a>                     <span class="dt">independent.variable.type =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;categorical&quot;</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="ot">NA</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="st">&quot;categorical&quot;</span>, <span class="dv">5</span>)), </span>
<span id="cb66-10"><a href="analysis.html#cb66-10"></a>                     <span class="dt">hypothesis.type =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;group_difference&quot;</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="st">&quot;direct_reporting&quot;</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="st">&quot;group_difference&quot;</span>, <span class="dv">5</span>)), </span>
<span id="cb66-11"><a href="analysis.html#cb66-11"></a>                     <span class="dt">repeat.for.variable =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="ot">NA</span>, <span class="dv">12</span>), <span class="kw">rep</span>(<span class="st">&quot;strata&quot;</span>, <span class="dv">5</span>))</span>
<span id="cb66-12"><a href="analysis.html#cb66-12"></a>                     )</span>
<span id="cb66-13"><a href="analysis.html#cb66-13"></a></span>
<span id="cb66-14"><a href="analysis.html#cb66-14"></a></span>
<span id="cb66-15"><a href="analysis.html#cb66-15"></a>my_dap </span></code></pre></div>
<pre><code>##                                             dependent.variable
## 1                             l4_which_difficult_access_health
## 2  j10_education_security_concerns_in_the_vicinity_of_facility
## 3                                                  b7_hohh_age
## 4                                                       b5_age
## 5                                       b9_hohh_marital_status
## 6                                    d1_hh_displacement_status
## 7                             l4_which_difficult_access_health
## 8  j10_education_security_concerns_in_the_vicinity_of_facility
## 9                                                  b7_hohh_age
## 10                                                      b5_age
## 11                                      b9_hohh_marital_status
## 12                                   d1_hh_displacement_status
## 13                            l4_which_difficult_access_health
## 14 j10_education_security_concerns_in_the_vicinity_of_facility
## 15                                                 b7_hohh_age
## 16                                                      b5_age
## 17                                   d1_hh_displacement_status
##    dependent.variable.type   independent.variable independent.variable.type
## 1              categorical                 strata               categorical
## 2              categorical                 strata               categorical
## 3                numerical                 strata               categorical
## 4                numerical                 strata               categorical
## 5              categorical                 strata               categorical
## 6              categorical                 strata               categorical
## 7              categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 8              categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 9                numerical                   &lt;NA&gt;                      &lt;NA&gt;
## 10               numerical                   &lt;NA&gt;                      &lt;NA&gt;
## 11             categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 12             categorical                   &lt;NA&gt;                      &lt;NA&gt;
## 13             categorical b9_hohh_marital_status               categorical
## 14             categorical b9_hohh_marital_status               categorical
## 15               numerical b9_hohh_marital_status               categorical
## 16               numerical b9_hohh_marital_status               categorical
## 17             categorical b9_hohh_marital_status               categorical
##     hypothesis.type repeat.for.variable
## 1  group_difference                &lt;NA&gt;
## 2  group_difference                &lt;NA&gt;
## 3  group_difference                &lt;NA&gt;
## 4  group_difference                &lt;NA&gt;
## 5  group_difference                &lt;NA&gt;
## 6  group_difference                &lt;NA&gt;
## 7  direct_reporting                &lt;NA&gt;
## 8  direct_reporting                &lt;NA&gt;
## 9  direct_reporting                &lt;NA&gt;
## 10 direct_reporting                &lt;NA&gt;
## 11 direct_reporting                &lt;NA&gt;
## 12 direct_reporting                &lt;NA&gt;
## 13 group_difference              strata
## 14 group_difference              strata
## 15 group_difference              strata
## 16 group_difference              strata
## 17 group_difference              strata</code></pre>
<p>To use a DAP, you need to use the function <strong>from_analysisplan_map_to_output</strong> instead of the combination of <strong>map_to_case</strong> and <strong>map_to_result</strong>. It will look for the case itself. <strong>from_analysisplan_map_to_output</strong> a list of list of results. So you need to wriggle a bit around to come to a master dataframe.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="analysis.html#cb68-1"></a>my_results &lt;-<span class="st"> </span>hypegrammaR<span class="op">::</span><span class="kw">from_analysisplan_map_to_output</span>(<span class="dt">data =</span>main_dataset,</span>
<span id="cb68-2"><a href="analysis.html#cb68-2"></a>                                <span class="dt">analysisplan =</span> my_dap,</span>
<span id="cb68-3"><a href="analysis.html#cb68-3"></a>                                <span class="dt">weighting =</span> my_weigthing_function,</span>
<span id="cb68-4"><a href="analysis.html#cb68-4"></a>                                <span class="dt">questionnaire =</span> my_questionnaire,</span>
<span id="cb68-5"><a href="analysis.html#cb68-5"></a>                                <span class="dt">confidence_level =</span> <span class="fl">.90</span>)</span>
<span id="cb68-6"><a href="analysis.html#cb68-6"></a></span>
<span id="cb68-7"><a href="analysis.html#cb68-7"></a>long_table &lt;-<span class="st"> </span>my_results<span class="op">$</span>results <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-8"><a href="analysis.html#cb68-8"></a><span class="st">  </span><span class="kw">lapply</span>(<span class="cf">function</span>(x) x[[<span class="st">&quot;summary.statistic&quot;</span>]]) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-9"><a href="analysis.html#cb68-9"></a><span class="st">  </span><span class="kw">do.call</span>(rbind, .)</span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="analysis.html#cb69-1"></a>long_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##                      dependent.var independent.var dependent.var.value
## 1 l4_which_difficult_access_health          strata  lack_of_facilities
## 2 l4_which_difficult_access_health          strata  lack_of_facilities
## 3 l4_which_difficult_access_health          strata  lack_of_facilities
## 4 l4_which_difficult_access_health          strata  lack_of_facilities
## 5 l4_which_difficult_access_health          strata    cost_of_medicine
## 6 l4_which_difficult_access_health          strata    cost_of_medicine
##   independent.var.value   numbers se        min       max repeat.var
## 1            20km_rural 0.2131148 NA 0.15352034 0.2727092       &lt;NA&gt;
## 2            20km_urban 0.1013514 NA 0.05248276 0.1502199       &lt;NA&gt;
## 3             5km_rural 0.2500000 NA 0.19147544 0.3085246       &lt;NA&gt;
## 4             5km_urban 0.1160221 NA 0.06915872 0.1628855       &lt;NA&gt;
## 5            20km_rural 0.8579235 NA 0.80711592 0.9087311       &lt;NA&gt;
## 6            20km_urban 0.8378378 NA 0.77815151 0.8975242       &lt;NA&gt;
##   repeat.var.value
## 1             &lt;NA&gt;
## 2             &lt;NA&gt;
## 3             &lt;NA&gt;
## 4             &lt;NA&gt;
## 5             &lt;NA&gt;
## 6             &lt;NA&gt;</code></pre>
</div>
<div id="srvyr-package" class="section level2">
<h2><span class="header-section-number">5.2</span> srvyr package</h2>
<p>“The srvyr package aims to add dplyr like syntax to the survey package.” It is a very useful package for a variety of aggregations of survey data.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="analysis.html#cb71-1"></a><span class="co">###makes some additions. </span></span>
<span id="cb71-2"><a href="analysis.html#cb71-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb71-3"><a href="analysis.html#cb71-3"></a><span class="kw">library</span>(butteR)</span>
<span id="cb71-4"><a href="analysis.html#cb71-4"></a><span class="kw">library</span>(srvyr)</span>
<span id="cb71-5"><a href="analysis.html#cb71-5"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb71-6"><a href="analysis.html#cb71-6"></a>df&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>)</span>
<span id="cb71-7"><a href="analysis.html#cb71-7"></a>dfsvy&lt;-<span class="kw">as_survey</span>(df)</span></code></pre></div>
<div id="categorical-variables" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Categorical variables</h3>
<p>srvyr package allows categorical variables to be broken down using a similar syntax as dplyr. Using dplyr you might typically calculate a percent mean as follows:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="analysis.html#cb72-1"></a>df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb72-2"><a href="analysis.html#cb72-2"></a><span class="st">  </span><span class="kw">group_by</span>(b9_hohh_marital_status) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb72-3"><a href="analysis.html#cb72-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb72-4"><a href="analysis.html#cb72-4"></a>    <span class="dt">n=</span><span class="kw">n</span>()</span>
<span id="cb72-5"><a href="analysis.html#cb72-5"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb72-6"><a href="analysis.html#cb72-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb72-7"><a href="analysis.html#cb72-7"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb72-8"><a href="analysis.html#cb72-8"></a>    <span class="dt">pct_mean=</span>n<span class="op">/</span><span class="kw">sum</span>(n)</span>
<span id="cb72-9"><a href="analysis.html#cb72-9"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   b9_hohh_marital_status                        n pct_mean
##   &lt;chr&gt;                                     &lt;int&gt;    &lt;dbl&gt;
## 1 divorced                                    183   0.113 
## 2 married                                     677   0.419 
## 3 separated_married_but_not_living_together    37   0.0229
## 4 single                                      129   0.0798
## 5 unmarried_but_living_together                96   0.0594
## 6 widowed                                     495   0.306</code></pre>
<p>To calculate the percent mean of a categorical variable using srvyr object is required. The syntax is quite similar to dplyr, but a bit less verbose. By specifying the vartype as “ci” we also get the upper and lower confidence intervals</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="analysis.html#cb75-1"></a>dfsvy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb75-2"><a href="analysis.html#cb75-2"></a><span class="st">  </span><span class="kw">group_by</span>(b9_hohh_marital_status) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb75-3"><a href="analysis.html#cb75-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb75-4"><a href="analysis.html#cb75-4"></a>    <span class="dt">pct_mean =</span> <span class="kw">survey_mean</span>(<span class="dt">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb75-5"><a href="analysis.html#cb75-5"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   b9_hohh_marital_status                    pct_mean pct_mean_low pct_mean_upp
##   &lt;chr&gt;                                        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 divorced                                    0.113        0.0977       0.129 
## 2 married                                     0.419        0.395        0.443 
## 3 separated_married_but_not_living_together   0.0229       0.0156       0.0302
## 4 single                                      0.0798       0.0666       0.0930
## 5 unmarried_but_living_together               0.0594       0.0478       0.0709
## 6 widowed                                     0.306        0.284        0.329</code></pre>
</div>
<div id="numeric-variables" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Numeric variables</h3>
<p>srvyr treats the calculation/aggregation of numeric variables differently in an attempt to mirror dplyr syntax</p>
<p>to calculate the mean and median expenditure in dplyr you would likely do the following</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="analysis.html#cb77-1"></a>df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb77-2"><a href="analysis.html#cb77-2"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb77-3"><a href="analysis.html#cb77-3"></a>    <span class="dt">mean_expenditure=</span> <span class="kw">mean</span>(n1_HH_total_expenditure,<span class="dt">na.rm=</span>T),</span>
<span id="cb77-4"><a href="analysis.html#cb77-4"></a>    <span class="dt">median_expenditure=</span><span class="kw">median</span>(n1_HH_total_expenditure,<span class="dt">na.rm=</span>T),</span>
<span id="cb77-5"><a href="analysis.html#cb77-5"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   mean_expenditure median_expenditure
##              &lt;dbl&gt;              &lt;dbl&gt;
## 1            5129.               4000</code></pre>
<p>If you wanted to subset this by another variable in dplyr you would add the group_by argument</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="analysis.html#cb79-1"></a>df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb79-2"><a href="analysis.html#cb79-2"></a><span class="st">  </span><span class="kw">group_by</span>(strata) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb79-3"><a href="analysis.html#cb79-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb79-4"><a href="analysis.html#cb79-4"></a>    <span class="dt">mean_expenditure=</span> <span class="kw">mean</span>(n1_HH_total_expenditure,<span class="dt">na.rm=</span>T),</span>
<span id="cb79-5"><a href="analysis.html#cb79-5"></a>    <span class="dt">median_expenditure=</span><span class="kw">median</span>(n1_HH_total_expenditure,<span class="dt">na.rm=</span>T),</span>
<span id="cb79-6"><a href="analysis.html#cb79-6"></a>    )</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 4 x 3
##   strata     mean_expenditure median_expenditure
##   &lt;chr&gt;                 &lt;dbl&gt;              &lt;dbl&gt;
## 1 20km_rural            5488.               4000
## 2 20km_urban            6208.               5000
## 3 5km_rural             3919.               3075
## 4 5km_urban             4942.               4000</code></pre>
<p>This is the reason why the syntax also varies between categorical and numeric variables in srvyr. Therefore, to do the same using srvyr you would do the following (with a survey object). Note that due to this difference in syntax the na.rm argument works for numeric variables, but <strong>does not work</strong> for categorical variables. This was modified when srvyr was updated from v 0.3.8</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="analysis.html#cb82-1"></a>dfsvy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-2"><a href="analysis.html#cb82-2"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb82-3"><a href="analysis.html#cb82-3"></a>   <span class="dt">mean=</span> <span class="kw">survey_mean</span>(n1_HH_total_expenditure,<span class="dt">na.rm=</span>T,<span class="dt">vartype =</span> <span class="st">&quot;ci&quot;</span>),</span>
<span id="cb82-4"><a href="analysis.html#cb82-4"></a>  )</span></code></pre></div>
<pre><code>##       mean mean_low mean_upp
## 1 5128.962 4891.389 5366.536</code></pre>
<p>similar to dplyr you can easily add a group_by argument to add a subset calculation</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="analysis.html#cb84-1"></a>dfsvy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb84-2"><a href="analysis.html#cb84-2"></a><span class="st">  </span><span class="kw">group_by</span>(strata) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb84-3"><a href="analysis.html#cb84-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb84-4"><a href="analysis.html#cb84-4"></a>   <span class="dt">mean=</span> <span class="kw">survey_mean</span>(n1_HH_total_expenditure,<span class="dt">na.rm=</span>T,<span class="dt">vartype =</span> <span class="st">&quot;ci&quot;</span>),</span>
<span id="cb84-5"><a href="analysis.html#cb84-5"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   strata      mean mean_low mean_upp
##   &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 20km_rural 5488.    4980.    5996.
## 2 20km_urban 6208.    5661.    6756.
## 3 5km_rural  3919.    3469.    4370.
## 4 5km_urban  4942.    4604.    5280.</code></pre>
</div>
</div>
<div id="butter-survey_collapse" class="section level2">
<h2><span class="header-section-number">5.3</span> butteR survey_collapse</h2>
<p>The survey_collapse function available in butteR aggregates both categorical and numerical columns of a srvyr object. It provides a standardized format output that includes mean/pct mean (point estimates), and the upper/lower confidence intervals along with the unweighted number/frequency for each response option. The survey_collapse function is built around the great srvyr package. The srvyr package is a more modern/tidyverse style wrapper for the survey package. Both the srvyr and survye packages are great and there use is highligh encouraged.</p>
<p>The main advantages of survey_collapse</p>
<ol style="list-style-type: decimal">
<li>The standardized output produced</li>
<li>Ability to analyze both categorical and numerical columns with a consistent syntax</li>
<li>Batch analyses and ability to perform many different subsetting investigations with ease</li>
</ol>
<p>Below is an example of its use.</p>
<p>First we must read in some data and make it into a srvyr object</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="analysis.html#cb86-1"></a><span class="co">###makes some additions. </span></span>
<span id="cb86-2"><a href="analysis.html#cb86-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb86-3"><a href="analysis.html#cb86-3"></a><span class="kw">library</span>(butteR)</span>
<span id="cb86-4"><a href="analysis.html#cb86-4"></a><span class="kw">library</span>(srvyr)</span>
<span id="cb86-5"><a href="analysis.html#cb86-5"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb86-6"><a href="analysis.html#cb86-6"></a>df&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>)</span>
<span id="cb86-7"><a href="analysis.html#cb86-7"></a>dfsvy&lt;-<span class="kw">as_survey</span>(df)</span></code></pre></div>
<p>For the purpose of the example I next choose a variety of different column types to analyze. As you can see I have selected select_one (categorical), select_multiple (binary categorical), and numerical columns. I then put these all into one vector.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="analysis.html#cb87-1"></a><span class="co"># here are some random concatenated select multiple parent questions</span></span>
<span id="cb87-2"><a href="analysis.html#cb87-2"></a>select_multiple_parent_cols&lt;-<span class="kw">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>,</span>
<span id="cb87-3"><a href="analysis.html#cb87-3"></a>                        <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>)</span>
<span id="cb87-4"><a href="analysis.html#cb87-4"></a>numeric_cols&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb87-5"><a href="analysis.html#cb87-5"></a>                 <span class="st">&quot;b5_age&quot;</span>)</span>
<span id="cb87-6"><a href="analysis.html#cb87-6"></a>select_one_cols&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;b9_hohh_marital_status&quot;</span>,</span>
<span id="cb87-7"><a href="analysis.html#cb87-7"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>)</span>
<span id="cb87-8"><a href="analysis.html#cb87-8"></a>mixed_columns&lt;-<span class="st"> </span><span class="kw">c</span>(select_multiple_parent_cols, numeric_cols, select_one_cols)</span></code></pre></div>
<p>A nice feature of the standardized output produced by survey_collapse is that you can perform variety of different types of analyses and then bind them together into one dataframe/tibble.</p>
<p>Therefore I fill an empty list with analysis to facilitate binding later. For the first analyses I simply aggregate all the columns specified as mean/pct mean. I next analyze the same variable but this time subset/disaggreated by the strata column. It’s a good idea to mutate an extra column indicating what exact analysis was done so that when they are binded together later they can more easily be manipulated</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="analysis.html#cb88-1"></a>outputs&lt;-<span class="kw">list</span>()</span>
<span id="cb88-2"><a href="analysis.html#cb88-2"></a></span>
<span id="cb88-3"><a href="analysis.html#cb88-3"></a>outputs<span class="op">$</span>overall&lt;-butteR<span class="op">::</span><span class="kw">survey_collapse</span>(<span class="dt">df =</span> dfsvy,<span class="dt">vars_to_analyze =</span> mixed_columns) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-4"><a href="analysis.html#cb88-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">analysis_level=</span> <span class="st">&quot;overall&quot;</span>)</span>
<span id="cb88-5"><a href="analysis.html#cb88-5"></a></span>
<span id="cb88-6"><a href="analysis.html#cb88-6"></a>outputs<span class="op">$</span>strata&lt;-butteR<span class="op">::</span><span class="kw">survey_collapse</span>(<span class="dt">df =</span> dfsvy,<span class="dt">vars_to_analyze =</span> mixed_columns,<span class="dt">disag =</span> <span class="st">&quot;strata&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-7"><a href="analysis.html#cb88-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">analysis_level=</span> <span class="st">&quot;strata&quot;</span>)</span></code></pre></div>
Here is an example of what the long format data looks like as a table.
<div style="border: 0px;overflow-x: scroll; width:100%; ">
<table class="table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:left;">
variable_val
</th>
<th style="text-align:left;">
subset_1_name
</th>
<th style="text-align:left;">
subset_1_val
</th>
<th style="text-align:right;">
mean/pct
</th>
<th style="text-align:right;">
mean/pct_low
</th>
<th style="text-align:right;">
mean/pct_upp
</th>
<th style="text-align:right;">
n_unweighted
</th>
<th style="text-align:left;">
analysis_level
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b7_hohh_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b7_hohh_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b7_hohh_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b7_hohh_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b5_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b5_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b5_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
b5_age
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
divorced
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.1007371
</td>
<td style="text-align:right;">
0.0714654
</td>
<td style="text-align:right;">
0.1300089
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.4594595
</td>
<td style="text-align:right;">
0.4109922
</td>
<td style="text-align:right;">
0.5079267
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
separated_married_but_not_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0196560
</td>
<td style="text-align:right;">
0.0061556
</td>
<td style="text-align:right;">
0.0331565
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
single
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0515971
</td>
<td style="text-align:right;">
0.0300831
</td>
<td style="text-align:right;">
0.0731110
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
unmarried_but_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0884521
</td>
<td style="text-align:right;">
0.0608365
</td>
<td style="text-align:right;">
0.1160677
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
widowed
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.2800983
</td>
<td style="text-align:right;">
0.2364263
</td>
<td style="text-align:right;">
0.3237702
</td>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
divorced
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.1138614
</td>
<td style="text-align:right;">
0.0828546
</td>
<td style="text-align:right;">
0.1448681
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.4331683
</td>
<td style="text-align:right;">
0.3847987
</td>
<td style="text-align:right;">
0.4815379
</td>
<td style="text-align:right;">
175
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
separated_married_but_not_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.0247525
</td>
<td style="text-align:right;">
0.0095860
</td>
<td style="text-align:right;">
0.0399189
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
single
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.1039604
</td>
<td style="text-align:right;">
0.0741674
</td>
<td style="text-align:right;">
0.1337534
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
unmarried_but_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.0495050
</td>
<td style="text-align:right;">
0.0283303
</td>
<td style="text-align:right;">
0.0706796
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
widowed
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.2747525
</td>
<td style="text-align:right;">
0.2311781
</td>
<td style="text-align:right;">
0.3183268
</td>
<td style="text-align:right;">
111
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
divorced
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.1019900
</td>
<td style="text-align:right;">
0.0723749
</td>
<td style="text-align:right;">
0.1316052
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.3955224
</td>
<td style="text-align:right;">
0.3476737
</td>
<td style="text-align:right;">
0.4433711
</td>
<td style="text-align:right;">
159
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
separated_married_but_not_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0199005
</td>
<td style="text-align:right;">
0.0062339
</td>
<td style="text-align:right;">
0.0335671
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
single
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0820896
</td>
<td style="text-align:right;">
0.0552275
</td>
<td style="text-align:right;">
0.1089516
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
unmarried_but_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0522388
</td>
<td style="text-align:right;">
0.0304647
</td>
<td style="text-align:right;">
0.0740129
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
widowed
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.3482587
</td>
<td style="text-align:right;">
0.3016375
</td>
<td style="text-align:right;">
0.3948799
</td>
<td style="text-align:right;">
140
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
divorced
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.1361386
</td>
<td style="text-align:right;">
0.1026629
</td>
<td style="text-align:right;">
0.1696143
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.3861386
</td>
<td style="text-align:right;">
0.3386134
</td>
<td style="text-align:right;">
0.4336638
</td>
<td style="text-align:right;">
156
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
separated_married_but_not_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0272277
</td>
<td style="text-align:right;">
0.0113412
</td>
<td style="text-align:right;">
0.0431142
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
single
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0816832
</td>
<td style="text-align:right;">
0.0549482
</td>
<td style="text-align:right;">
0.1084181
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
unmarried_but_living_together
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0470297
</td>
<td style="text-align:right;">
0.0263643
</td>
<td style="text-align:right;">
0.0676951
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
b9_hohh_marital_status
</td>
<td style="text-align:left;">
widowed
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.3217822
</td>
<td style="text-align:right;">
0.2761803
</td>
<td style="text-align:right;">
0.3673841
</td>
<td style="text-align:right;">
130
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
displaced_and_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0466830
</td>
<td style="text-align:right;">
0.0261663
</td>
<td style="text-align:right;">
0.0671998
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
displaced_but_does_not_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0024570
</td>
<td style="text-align:right;">
-0.0023578
</td>
<td style="text-align:right;">
0.0072718
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.9115479
</td>
<td style="text-align:right;">
0.8839323
</td>
<td style="text-align:right;">
0.9391635
</td>
<td style="text-align:right;">
371
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
partially_displaced_and_dont_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0073710
</td>
<td style="text-align:right;">
-0.0009479
</td>
<td style="text-align:right;">
0.0156899
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
partially_displaced_and_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0221130
</td>
<td style="text-align:right;">
0.0078116
</td>
<td style="text-align:right;">
0.0364144
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
used_to_be_displaced_but_returned_and_has_no_status_of_idp
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_rural
</td>
<td style="text-align:right;">
0.0098280
</td>
<td style="text-align:right;">
0.0002340
</td>
<td style="text-align:right;">
0.0194220
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
displaced_and_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.0272277
</td>
<td style="text-align:right;">
0.0113412
</td>
<td style="text-align:right;">
0.0431142
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.9603960
</td>
<td style="text-align:right;">
0.9413585
</td>
<td style="text-align:right;">
0.9794336
</td>
<td style="text-align:right;">
388
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
partially_displaced_and_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.0099010
</td>
<td style="text-align:right;">
0.0002361
</td>
<td style="text-align:right;">
0.0195659
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
used_to_be_displaced_but_returned_and_has_no_status_of_idp
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
20km_urban
</td>
<td style="text-align:right;">
0.0024752
</td>
<td style="text-align:right;">
-0.0023753
</td>
<td style="text-align:right;">
0.0073258
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
displaced_and_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0895522
</td>
<td style="text-align:right;">
0.0616100
</td>
<td style="text-align:right;">
0.1174944
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
displaced_but_does_not_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0049751
</td>
<td style="text-align:right;">
-0.0019100
</td>
<td style="text-align:right;">
0.0118603
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.8781095
</td>
<td style="text-align:right;">
0.8460944
</td>
<td style="text-align:right;">
0.9101245
</td>
<td style="text-align:right;">
353
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
partially_displaced_and_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0024876
</td>
<td style="text-align:right;">
-0.0023871
</td>
<td style="text-align:right;">
0.0073622
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
used_to_be_displaced_but_returned_and_has_a_status_of_idp
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0024876
</td>
<td style="text-align:right;">
-0.0023871
</td>
<td style="text-align:right;">
0.0073622
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
used_to_be_displaced_but_returned_and_has_no_status_of_idp
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_rural
</td>
<td style="text-align:right;">
0.0223881
</td>
<td style="text-align:right;">
0.0079108
</td>
<td style="text-align:right;">
0.0368653
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
displaced_and_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0618812
</td>
<td style="text-align:right;">
0.0383618
</td>
<td style="text-align:right;">
0.0854005
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
displaced_but_does_not_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0049505
</td>
<td style="text-align:right;">
-0.0019007
</td>
<td style="text-align:right;">
0.0118017
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.9108911
</td>
<td style="text-align:right;">
0.8830805
</td>
<td style="text-align:right;">
0.9387017
</td>
<td style="text-align:right;">
368
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
partially_displaced_and_dont_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0024752
</td>
<td style="text-align:right;">
-0.0023753
</td>
<td style="text-align:right;">
0.0073258
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
partially_displaced_and_have_idp_status
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0049505
</td>
<td style="text-align:right;">
-0.0019007
</td>
<td style="text-align:right;">
0.0118017
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
used_to_be_displaced_but_returned_and_has_a_status_of_idp
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0024752
</td>
<td style="text-align:right;">
-0.0023753
</td>
<td style="text-align:right;">
0.0073258
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
strata
</td>
</tr>
<tr>
<td style="text-align:left;">
d1_hh_displacement_status
</td>
<td style="text-align:left;">
used_to_be_displaced_but_returned_and_has_no_status_of_idp
</td>
<td style="text-align:left;">
strata
</td>
<td style="text-align:left;">
5km_urban
</td>
<td style="text-align:right;">
0.0123762
</td>
<td style="text-align:right;">
0.0015841
</td>
<td style="text-align:right;">
0.0231684
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
strata
</td>
</tr>
</tbody>
</table>
</div>
<p>This is a great format for manipulating/filtering and then graphing with ggplot</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="analysis.html#cb89-1"></a>output_df&lt;-<span class="st"> </span><span class="kw">bind_rows</span>(outputs)</span>
<span id="cb89-2"><a href="analysis.html#cb89-2"></a></span>
<span id="cb89-3"><a href="analysis.html#cb89-3"></a>output_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-4"><a href="analysis.html#cb89-4"></a><span class="st">  </span><span class="kw">filter</span>(analysis_level<span class="op">==</span><span class="st">&quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-5"><a href="analysis.html#cb89-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">question_val=</span> <span class="kw">paste0</span>(variable,<span class="st">&quot;.&quot;</span>,variable_val)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-6"><a href="analysis.html#cb89-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> question_val,<span class="dt">y=</span> <span class="st">`</span><span class="dt">mean/pct</span><span class="st">`</span>))<span class="op">+</span></span>
<span id="cb89-7"><a href="analysis.html#cb89-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.3</span>))<span class="op">+</span></span>
<span id="cb89-8"><a href="analysis.html#cb89-8"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span> <span class="st">`</span><span class="dt">mean/pct_low</span><span class="st">`</span>, <span class="dt">ymax=</span> <span class="st">`</span><span class="dt">mean/pct_upp</span><span class="st">`</span>), </span>
<span id="cb89-9"><a href="analysis.html#cb89-9"></a>                <span class="dt">width=</span><span class="fl">0.2</span>,<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.3</span>))<span class="op">+</span></span>
<span id="cb89-10"><a href="analysis.html#cb89-10"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent,<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.1</span>))<span class="op">+</span></span>
<span id="cb89-11"><a href="analysis.html#cb89-11"></a><span class="st">  </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb89-12"><a href="analysis.html#cb89-12"></a><span class="st">  </span><span class="kw">theme_bw</span>()<span class="op">+</span></span>
<span id="cb89-13"><a href="analysis.html#cb89-13"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb89-14"><a href="analysis.html#cb89-14"></a>    <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb89-15"><a href="analysis.html#cb89-15"></a>    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>),</span>
<span id="cb89-16"><a href="analysis.html#cb89-16"></a>    <span class="dt">legend.title=</span> <span class="kw">element_blank</span>()</span>
<span id="cb89-17"><a href="analysis.html#cb89-17"></a>  ) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="analysis.html#cb90-1"></a><span class="co"># Easy to plot subset findings as well!</span></span>
<span id="cb90-2"><a href="analysis.html#cb90-2"></a>output_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-3"><a href="analysis.html#cb90-3"></a><span class="st">  </span><span class="kw">filter</span>(analysis_level<span class="op">==</span><span class="st">&quot;strata&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-4"><a href="analysis.html#cb90-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">question_val=</span> <span class="kw">paste0</span>(variable,<span class="st">&quot;.&quot;</span>,variable_val)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-5"><a href="analysis.html#cb90-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> question_val,<span class="dt">y=</span> <span class="st">`</span><span class="dt">mean/pct</span><span class="st">`</span>, <span class="dt">color=</span>subset_<span class="dv">1</span>_val))<span class="op">+</span></span>
<span id="cb90-6"><a href="analysis.html#cb90-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.3</span>))<span class="op">+</span></span>
<span id="cb90-7"><a href="analysis.html#cb90-7"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span> <span class="st">`</span><span class="dt">mean/pct_low</span><span class="st">`</span>, <span class="dt">ymax=</span> <span class="st">`</span><span class="dt">mean/pct_upp</span><span class="st">`</span>), </span>
<span id="cb90-8"><a href="analysis.html#cb90-8"></a>                <span class="dt">width=</span><span class="fl">0.2</span>,<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.3</span>))<span class="op">+</span></span>
<span id="cb90-9"><a href="analysis.html#cb90-9"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent,<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.1</span>))<span class="op">+</span></span>
<span id="cb90-10"><a href="analysis.html#cb90-10"></a><span class="st">  </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb90-11"><a href="analysis.html#cb90-11"></a><span class="st">  </span><span class="kw">theme_bw</span>()<span class="op">+</span></span>
<span id="cb90-12"><a href="analysis.html#cb90-12"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb90-13"><a href="analysis.html#cb90-13"></a>    <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb90-14"><a href="analysis.html#cb90-14"></a>    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>),</span>
<span id="cb90-15"><a href="analysis.html#cb90-15"></a>    <span class="dt">legend.title=</span> <span class="kw">element_blank</span>()</span>
<span id="cb90-16"><a href="analysis.html#cb90-16"></a>  ) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-2.png" width="672" /></p>
<div id="select_one" class="section level3">
<h3><span class="header-section-number">5.3.1</span> select_one</h3>
</div>
<div id="select_mutiple" class="section level3">
<h3><span class="header-section-number">5.3.2</span> select_mutiple</h3>
</div>
</div>
<div id="analysis-with-numerical-variables" class="section level2">
<h2><span class="header-section-number">5.4</span> Analysis with numerical variables</h2>
<p>Summarytools (CRAN package)
Spatstat
hypegrammaR / koboquest / butteR
### Averages
### Median</p>
</div>
<div id="weights" class="section level2">
<h2><span class="header-section-number">5.5</span> Weights</h2>
<p>surveyweights
survey (CRAN package)
srvyr (CRAN package)</p>
</div>
<div id="repeating-the-above" class="section level2">
<h2><span class="header-section-number">5.6</span> Repeating the above</h2>
</div>
<div id="top-3" class="section level2">
<h2><span class="header-section-number">5.7</span> Top 3</h2>
</div>
<div id="borda-count" class="section level2">
<h2><span class="header-section-number">5.8</span> Borda count</h2>
</div>
<div id="hypothesis-testing" class="section level2">
<h2><span class="header-section-number">5.9</span> Hypothesis testing</h2>
<div id="t-test" class="section level3">
<h3><span class="header-section-number">5.9.1</span> T-test</h3>
</div>
<div id="anova" class="section level3">
<h3><span class="header-section-number">5.9.2</span> ANOVA</h3>
</div>
<div id="chi-squares" class="section level3">
<h3><span class="header-section-number">5.9.3</span> chi-squares</h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="composite-indicators.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="outputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
