# Analysis

## Frequencies with categorical variables
hypegrammaR / koboquest / butteR/ srvyr



```{r, tidy=FALSE, message= F, warning=F, error=F, echo=T}
###makes some additions. 
library(tidyverse)
library(butteR)
library(srvyr)
df<-read_csv("inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv")
dfsvy<-as_survey(df)
```
The survey_collapse function available in butteR aggregates both categorical and numerical columns of srvyr object. It provides a standardized format output that includes mean/pct mean (point estimate), and the upper/lower confidence intervals along with the unweight number/frequency of each option. The main utility of survey_collapse is for batch analyses and its ability to collapse binary categorical (select multiple), categorical (select one), and numeric intervals

```{r,message=F,warning=F, results="hide"}
# here are some random concatenated select multiple parent questions
select_multiple_parent_cols<-c("l4_which_difficult_access_health",
                        "j10_education_security_concerns_in_the_vicinity_of_facility")
numeric_cols<- c("b7_hohh_age",
                 "b5_age")
select_one_cols<- c("b9_hohh_marital_status",
                    "d1_hh_displacement_status")
mixed_columns<- c(select_multiple_parent_cols, numeric_cols, select_one_cols)

outputs<-list()
outputs$overall<-butteR::survey_collapse(df = dfsvy,vars_to_analyze = mixed_columns) %>% 
  mutate(analysis_level= "overall")
outputs$strata<-butteR::survey_collapse(df = dfsvy,vars_to_analyze = mixed_columns,disag = "strata") %>% 
  mutate(analysis_level= "strata")



```

All of the columns provided to the function are analyzed in a standard long format so that multiple types of analyses and aggregations can be run and binded together and then easily piped into a ggplot work flow

```{r}
output_df<- bind_rows(outputs)

output_df %>% 
  filter(analysis_level=="overall") %>% 
  mutate(question_val= paste0(variable,".",variable_val)) %>% 
  ggplot(aes(x= question_val,y= `mean/pct`))+
  geom_point(stat="identity", position = position_dodge(width = 0.3))+
  geom_errorbar(aes(ymin= `mean/pct_low`, ymax= `mean/pct_upp`), 
                width=0.2,position = position_dodge(width = 0.3))+
  scale_y_continuous(labels = scales::percent,breaks = seq(0,1,by=0.1))+
  coord_flip()+
  theme_bw()+
  theme(
    axis.title = element_blank(),
    axis.text.x = element_text(angle=90),
    legend.title= element_blank()
  ) 


# Easy to plot subset findings as well!
output_df %>% 
  filter(analysis_level=="strata") %>% 
  mutate(question_val= paste0(variable,".",variable_val)) %>% 
  ggplot(aes(x= question_val,y= `mean/pct`, color=subset_1_val))+
  geom_point(stat="identity", position = position_dodge(width = 0.3))+
  geom_errorbar(aes(ymin= `mean/pct_low`, ymax= `mean/pct_upp`), 
                width=0.2,position = position_dodge(width = 0.3))+
  scale_y_continuous(labels = scales::percent,breaks = seq(0,1,by=0.1))+
  coord_flip()+
  theme_bw()+
  theme(
    axis.title = element_blank(),
    axis.text.x = element_text(angle=90),
    legend.title= element_blank()
  ) 


```

### select_one 
### select_mutiple

## Analysis with numerical variables
Summarytools (CRAN package)
Spatstat
hypegrammaR / koboquest / butteR
### Averages
### Median

## Analysis by strata or subset
### By strata, overall, dissagregatios

## Weights
surveyweights
survey (CRAN package)
srvyr (CRAN package)

## Repeating the above

## Top 3

## Borda count

## Hypothesis testing
### T-test
### ANOVA
### chi-squares


